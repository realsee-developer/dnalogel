import{aE as pt,aF as ut,aj as Ee,Z as ke,V as D,aG as mt,aH as ft,aI as ht,s as vt,aB as Pt,S as _t,v as Oe,F as be,u as bt,P as wt,aJ as $e,r as le,J as yt,q as Ge,n as Tt,j as ae,G as St,p as xt,I as Et,b as kt}from"./index-85b64ddc.js";import{R as Ot,G as $t,H as Mt}from"./index-62a9cd62.js";import{B as Ct}from"./Box-d96aca33.js";import{u as Je,D as Xe}from"./useFetchDatas-45e33e50.js";import{g as jt}from"./getInitialParamFromUrl-5dd39f79.js";import{E as Dt,u as Ft,v as It,a as Rt}from"./Point-d3172315.js";import{C as Ke,T as Qe,F as et,Q as tt,Y as Lt,N as ye,a as fe,a1 as At,J as Te,K as H,t as Y,r as Z,n as k,l as it,X as me,p as z,c as zt,a8 as Yt,d as Wt,f as Nt}from"./index-0b761db4.js";import{h as Zt}from"./index-94bb1ebd.js";import"./createTheme-a7bd8e9d.js";import"./useTheme-28230d65.js";var Ht=Object.defineProperty,Me=Object.getOwnPropertySymbols,Bt=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable,Ce=(t,e,i)=>e in t?Ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,je=(t,e)=>{for(var i in e||(e={}))Bt.call(e,i)&&Ce(t,i,e[i]);if(Me)for(var i of Me(e))Ut.call(e,i)&&Ce(t,i,e[i]);return t},Vt=(t,e,i)=>new Promise((n,o)=>{var r=l=>{try{c(i.next(l))}catch(h){o(h)}},s=l=>{try{c(i.throw(l))}catch(h){o(h)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(r,s);c((i=i.apply(t,e)).next())});const qt=(t,e)=>{var i,n;const o=new Dt;let r=(n=(i=e==null?void 0:e.initialState)==null?void 0:i.enabled)!=null?n:!0,s=!1,c=!0,l=null;const h=je(je({},{lookAtCurrentCamera:!1,lockedPanoIndex:null,lockedLatitude:null,lockedLongitude:null}),e==null?void 0:e.config),p=new pt,u=new ut(60);u.near=1,u.updateTime(Date.now());let f=new Ee,S,O;{const m=new ke(16777215,.5);m.position.copy(new D(1,1,1)),p.add(m)}{const m=new ke(16777215,.3);p.add(m)}{const m=new mt(16777215,.3);p.add(m)}p.add(f);const I=()=>Vt(void 0,null,function*(){var m,T,C,R,de;if(s||!((T=(m=t.work)==null?void 0:m.model)!=null&&T.file))return;p.remove(f),f=yield ft(t.work.model.file,{textureOptions:{size:128,quality:70},textureArray:(C=t.work.model)==null?void 0:C.textures,textureBaseUri:(R=t.work.model)==null?void 0:R.textureBase,fetcher:(de=h.fetcher)!=null?de:void 0}).then(he=>{const ce=he.scene;return ce.rotateX(-Math.PI/2),ce});const V=Ot(f),A=new Pt;A.expandByPoint(new D(V.min.x,V.min.z,-V.min.y)),A.expandByPoint(new D(V.max.x,V.max.z,-V.max.y));const ge=Math.pow(Math.pow(A.max.x-A.min.x+1,2)+Math.pow(A.max.y-A.min.y+1,2)+Math.pow(A.max.z-A.min.z+1,2),1/2);let ne=ge/2/Math.tan(Math.PI*u.fov/360);u.aspect<1&&(ne=S/u.aspect),S=isNaN(ne)?ge:ne,O=A.getCenter(new D),p.add(f),s=!0,o.emit("loaded"),a()});r&&I();const v=()=>{if(t.renderer)return l||(l=new ht({antialias:!1,alpha:!0}),l.setPixelRatio(t.renderer.getPixelRatio()),l.outputEncoding=vt,l.setClearColor(1579548,0),l.autoClear=!0),l},_=()=>{p.remove(f),f=new Ee,p.add(f),s=!1,o.emit("willLoad"),a()},y=()=>{r&&(s||I())},W=()=>{var m,T;r||(r=!0,p.add(f),!s&&(T=(m=t.work)==null?void 0:m.model)!=null&&T.file&&I(),a())},B=()=>{r&&(p.remove(f),c=!0,L(),r=!1)},ee=(m,T={})=>{const C=v();if(!C)return;m.appendChild(C.domElement),G(T);const R=window.getComputedStyle(m).position;R!=="relative"&&R!=="absolute"&&R!=="fixed"&&R!=="sticky"&&(m.style.position="relative")},G=(m={})=>{if(!l)return;const T=l.domElement.parentNode;if(T!=null&&T.nodeName){const{width:C=T.offsetWidth,height:R=T.offsetHeight}=m;l.setSize(C,R),u.aspect=C/R,u.updateProjectionMatrix()}a()},a=()=>{if(!r||!S||!O)return;const m=t.getPose();m.fov=u.fov,m.offset=O,m.distance=S,typeof h.lockedLatitude=="number"&&(m.latitude=h.lockedLatitude),typeof h.lockedLongitude=="number"&&(m.longitude=h.lockedLongitude),typeof h.lockedPanoIndex=="number"&&(m.offset=t.work.observers[h.lockedPanoIndex].standingPosition.clone()),h.lookAtCurrentCamera&&(m.offset=t.camera.position.clone().setY(t.camera.position.y+1)),u.setFromPose(m),c=!0},L=()=>{!r||c!==!0||!l||!l.domElement.parentNode||l.domElement.parentNode.offsetWidth===0||(l.render(p,u),c=!1)},F=()=>{l&&l.dispose(),l=null},U=m=>{Object.assign(h,m),a()},J=()=>({enabled:r});return t.on("loaded",y),t.on("willLoad",_),t.on("cameraDirectionUpdate",a),t.on("dispose",F),t.on("renderFrame",L),t.on("cameraPositionUpdate",a),{appendTo:ee,refresh:G,changeConfigs:U,enable:W,disable:B,getCurrentState:J,hooks:o}};var Gt=Object.defineProperty,Jt=Object.defineProperties,Xt=Object.getOwnPropertyDescriptors,De=Object.getOwnPropertySymbols,Kt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable,we=(t,e,i)=>e in t?Gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Fe=(t,e)=>{for(var i in e||(e={}))Kt.call(e,i)&&we(t,i,e[i]);if(De)for(var i of De(e))Qt.call(e,i)&&we(t,i,e[i]);return t},Ie=(t,e)=>Jt(t,Xt(e)),Q=(t,e,i)=>(we(t,typeof e!="symbol"?e+"":e,i),i);const at="v2.0.1",Re=`CSS3DRenderPlugin@${at}`;class ei extends Ft{constructor(e){super(),Q(this,"five"),Q(this,"behindFiveContainer"),Q(this,"frontFiveContainer"),Q(this,"VERSION",at),Q(this,"staticPrefix",$t),Q(this,"created3DElementResults",[]),Q(this,"create3DDomContainer",(i,n)=>{if(this.state.disposed)return;const o=(()=>{var p;(n==null?void 0:n.dpr)!==void 0&&console.warn(`${Re}: please use "config.devicePixelRatio" replace "config.dpr"`);const u={ratio:.00216,devicePixelRatio:(p=n==null?void 0:n.dpr)!=null?p:1,mode:"front",autoRender:!0,wrapperStyle:{}};return Object.assign(u,n,(n==null?void 0:n.mode)==="behind"?{scene:this.five.scene}:void 0)})(),{autoRender:r}=o;o.mode==="behind"&&o.behindFiveContainer&&(this.behindFiveContainer=o.behindFiveContainer);const s=this.create3DElement(this.five.camera,i,Ie(Fe({},o),{autoRender:!1}));if(!s)return;const c=s.dispose;s.dispose=()=>(this.created3DElementResults.includes(s)&&this.created3DElementResults.splice(this.created3DElementResults.indexOf(s),1),c());const l=()=>{var p,u;const f=s.css3DObject.mode==="front"?(u=this.frontFiveContainer)!=null?u:(p=this.five.getElement())==null?void 0:p.parentElement:this.getBehindFiveElement();if(!f)return console.error(`${Re}: wrapper is ${f}; mode is ${s.css3DObject.mode}`);s.appendToElement(f),s.render(),this.created3DElementResults.push(s)},h=()=>{Rt(this.five).then(()=>l())};return r&&h(),Ie(Fe({},s),{render:r?void 0:h})}),this.five=e}disposeAll(){return this.dispose()}setState(...e){const i=super.setState(...e);return this.five.needsRender=!0,i}appendToFrontFiveContainer(e){this.frontFiveContainer=e,this.created3DElementResults.forEach(i=>{i.css3DObject.mode==="front"&&i.appendToElement(e)})}appendToBehindFiveContainer(e){this.behindFiveContainer=e,this.created3DElementResults.forEach(i=>{i.css3DObject.mode==="behind"&&i.appendToElement(e)})}getBehindFiveElement(){return this.behindFiveContainer?this.behindFiveContainer:(this.behindFiveContainer=It(this.five),this.behindFiveContainer)}clear(){this.created3DElementResults.forEach(e=>{e.dispose()}),this.created3DElementResults=[]}}const ti=t=>new ei(t),nt=Zt(null);function ii(t){tt(t,"svelte-19zi46m",".PanoSpatialTagPlugin__tag-origin.svelte-19zi46m{position:absolute;width:0.5rem;height:0.5rem;border-radius:50%;background:#fff;box-shadow:0 0 .6rem #fff;transform:translate(-50%, -50%) scale(1);transform-origin:center center;animation:svelte-19zi46m-PanoSpatialTagPlugin__tag-origin 1.2s forwards;pointer-events:auto}.PanoSpatialTagPlugin__tag-origin.svelte-19zi46m:after{content:'';position:absolute;top:50%;height:50%;width:2rem;height:2rem;transform:translate(-50%, -50%)}.PanoSpatialTagPlugin__tag-origin-destroy.svelte-19zi46m{transform:translate(-50%, -50%) scale(0.6);animation:svelte-19zi46m-PanoSpatialTagPlugin__tag-origin-destroy 1.2s forwards .7s}@keyframes svelte-19zi46m-PanoSpatialTagPlugin__tag-origin{0%{transform:translate(-50%, -50%) scale(1);opacity:0}100%{transform:translate(-50%, -50%) scale(0.6);opacity:1 }}@keyframes svelte-19zi46m-PanoSpatialTagPlugin__tag-origin-destroy{0%{transform:translate(-50%, -50%) scale(0.6);opacity:1}10%{transform:translate(-50%, -50%) scale(1);opacity:0.9}100%{transform:translate(-50%, -50%) scale(1);opacity:0}}")}function Le(t,e,i){const n=t.slice();return n[3]=e[i],n}function Ae(t){let e,i=`${t[3].top}%`,n=`${t[3].left}%`,o,r;function s(){return t[2](t[3])}return{c(){e=H("i"),Y(e,"class","svelte-19zi46m"),Z(e,"PanoSpatialTagPlugin__tag-origin",!0),Z(e,"PanoSpatialTagPlugin__tag-origin-destroy",t[3].destroying),k(e,"top",i),k(e,"left",n),k(e,"visibility",t[3].front?"visible":"hidden")},m(c,l){ye(c,e,l),o||(r=it(e,"click",s),o=!0)},p(c,l){t=c,l&1&&Z(e,"PanoSpatialTagPlugin__tag-origin-destroy",t[3].destroying),l&1&&i!==(i=`${t[3].top}%`)&&k(e,"top",i),l&1&&n!==(n=`${t[3].left}%`)&&k(e,"left",n),l&1&&k(e,"visibility",t[3].front?"visible":"hidden")},d(c){c&&Te(e),o=!1,r()}}}function ai(t){let e,i=t[0],n=[];for(let o=0;o<i.length;o+=1)n[o]=Ae(Le(t,i,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Lt()},m(o,r){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(o,r);ye(o,e,r)},p(o,[r]){if(r&3){i=o[0];let s;for(s=0;s<i.length;s+=1){const c=Le(o,i,s);n[s]?n[s].p(c,r):(n[s]=Ae(c),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=i.length}},i:fe,o:fe,d(o){At(n,o),o&&Te(e)}}}function ni(t,e,i){let{origins:n}=e;const o=s=>{nt.update(()=>`${s}-PanoSpatialTagPlugin-${Date.now()}`)},r=s=>o(s.id);return t.$$set=s=>{"origins"in s&&i(0,n=s.origins)},[n,o,r]}class oi extends Ke{constructor(e){super(),Qe(this,e,ni,ai,et,{origins:0},ii)}}function si(t){tt(t,"svelte-vi2gid",`.PanoSpatialTagPlugin__tag-x.svelte-vi2gid.svelte-vi2gid{position:absolute;top:0;left:0;display:block;white-space:nowrap;box-sizing:border-box;width:25rem;height:14rem;color:#fff;transform:translate(0, -100%);transition:height 0.5s linear}.PanoSpatialTagPlugin__tag-shadow.svelte-vi2gid.svelte-vi2gid{content:'';position:absolute;width:30rem;height:30rem;top:-15rem;left:-15rem;z-index:-1;opacity:0;transition:opacity 0.8s 0.6s;background-size:30rem 30rem}.PanoSpatialTagPlugin__tag-line.svelte-vi2gid.svelte-vi2gid{position:absolute;left:-1rem;width:2rem;height:100%;overflow:hidden}.PanoSpatialTagPlugin__tag-flagpole.svelte-vi2gid.svelte-vi2gid{position:absolute;top:0;left:1rem;height:calc(100% - 1.5rem);width:0.15rem;background:linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.1));box-shadow:0 0.1rem 0.5rem rgba(0, 0, 0, 0.2);opacity:0;transform:translate(-50%, 60%) scaleY(0);transition:transform 0.4s cubic-bezier(0.44, 0.44, 0.74, 0.98), opacity 0.4s cubic-bezier(0.44, 0.44, 0.74, 0.98), width 0.5s linear,
      height 0.5s linear;transform-origin:center bottom}.PanoSpatialTagPlugin__tag-line1.svelte-vi2gid.svelte-vi2gid{position:absolute;top:0;left:0.3rem;height:1.8rem;width:0.1rem;background:#fff;opacity:0;transform:translate(-50%, 200%) scaleY(0);transform-origin:center top}.PanoSpatialTagPlugin__tag-line2.svelte-vi2gid.svelte-vi2gid{position:absolute;top:0;left:0.5rem;height:1.8rem;width:0.1rem;background:#fff;opacity:0;transform:translate(-50%, 200%) scaleY(0);transform-origin:center top}.PanoSpatialTagPlugin__tag-show.svelte-vi2gid .PanoSpatialTagPlugin__tag-line1.svelte-vi2gid{animation:svelte-vi2gid-PanoSpatialTagPlugin__tag-line1 linear 0.5s forwards 0.45s}.PanoSpatialTagPlugin__tag-show.svelte-vi2gid .PanoSpatialTagPlugin__tag-line2.svelte-vi2gid{animation:svelte-vi2gid-PanoSpatialTagPlugin__tag-line2 linear 0.5s forwards 0.65s}.PanoSpatialTagPlugin__tag-x.PanoSpatialTagPlugin__tag-upside-down.svelte-vi2gid.svelte-vi2gid{transform:translate(0, 0)}.PanoSpatialTagPlugin__tag-upside-down.svelte-vi2gid .PanoSpatialTagPlugin__tag-line.svelte-vi2gid{transform:scaleY(-1)}.PanoSpatialTagPlugin__tag-animate.svelte-vi2gid.svelte-vi2gid{position:relative;height:100%;overflow:hidden;transform-origin:left top;transition:transform 0.5s linear}.PanoSpatialTagPlugin__tag-upside-down.svelte-vi2gid .PanoSpatialTagPlugin__tag-animate.svelte-vi2gid{transform-origin:left bottom}.PanoSpatialTagPlugin__tag-content.svelte-vi2gid.svelte-vi2gid{position:absolute;display:inline-block;transform:translate(-100%, 0);transition:transform 0.9s cubic-bezier(0, 0.65, 0.16, 1.08) 0.6s;padding-left:0.5rem;font-size:1rem}.PanoSpatialTagPlugin__tag-upside-down.svelte-vi2gid .PanoSpatialTagPlugin__tag-content.svelte-vi2gid{bottom:0}.PanoSpatialTagPlugin__tag-show.svelte-vi2gid .PanoSpatialTagPlugin__tag-flagpole.svelte-vi2gid{opacity:1;transform:translate(-50%, 0) scaleY(1)}.PanoSpatialTagPlugin__tag-upside-down.svelte-vi2gid .PanoSpatialTagPlugin__tag-shadow.svelte-vi2gid{top:unset;bottom:-15rem}.PanoSpatialTagPlugin__tag-show.svelte-vi2gid .PanoSpatialTagPlugin__tag-shadow.svelte-vi2gid{opacity:0.32}.PanoSpatialTagPlugin__tag-show.svelte-vi2gid .PanoSpatialTagPlugin__tag-content.svelte-vi2gid{transform:translate(0, 0)}.PanoSpatialTagPlugin__tag-hide.svelte-vi2gid .PanoSpatialTagPlugin__tag-flagpole.svelte-vi2gid{opacity:0;transform:translate(-50%, 60%) scaleY(0);transition:transform 0.5s 0.55s, opacity 0.4s 0.55s}.PanoSpatialTagPlugin__tag-hide.svelte-vi2gid .PanoSpatialTagPlugin__tag-shadow.svelte-vi2gid{opacity:0;transition:opacity 0.8s}.PanoSpatialTagPlugin__tag-hide.svelte-vi2gid .PanoSpatialTagPlugin__tag-content.svelte-vi2gid{transform:translate(-100%, 0);transition:transform 0.6s cubic-bezier(0.53, 0.06, 0.88, 0.59)}.PanoSpatialTagPlugin__tag-hide.svelte-vi2gid .PanoSpatialTagPlugin__tag-content .svelte-vi2gid{pointer-events:none}.PanoSpatialTagPlugin__tag-hide.svelte-vi2gid .PanoSpatialTagPlugin__tag-line1.svelte-vi2gid{opacity:0.5;transform:translate(-50%, 10%) scaleY(0);animation:svelte-vi2gid-PanoSpatialTagPlugin__tag-line1-hide linear 0.28s forwards 0.3s}.PanoSpatialTagPlugin__tag-hide.svelte-vi2gid .PanoSpatialTagPlugin__tag-line2.svelte-vi2gid{opacity:0.5;transform:translate(-50%, 0) scaleY(0);animation:svelte-vi2gid-PanoSpatialTagPlugin__tag-line2-hide linear 0.28s forwards 0.45s}@keyframes svelte-vi2gid-PanoSpatialTagPlugin__tag-line1{0%{opacity:0;transform:translate(-50%, 250%) scaleY(1)}50%{opacity:0.5;transform:translate(-50%, 135%) scaleY(1)}100%{opacity:0.5;transform:translate(-50%, 20%) scaleY(0)}}@keyframes svelte-vi2gid-PanoSpatialTagPlugin__tag-line2{0%{opacity:0;transform:translate(-50%, 250%) scaleY(1)}50%{opacity:0.5;transform:translate(-50%, 125%) scaleY(1)}100%{opacity:0.5;transform:translate(-50%, 0) scaleY(0)}}@keyframes svelte-vi2gid-PanoSpatialTagPlugin__tag-line1-hide{0%{opacity:0.5;transform:translate(-50%, 10%) scaleY(0)}50%{opacity:0.2;transform:translate(-50%, 105%) scaleY(1)}100%{opacity:0;transform:translate(-50%, 200%) scaleY(0)}}@keyframes svelte-vi2gid-PanoSpatialTagPlugin__tag-line2-hide{0%{opacity:0.5;transform:translate(-50%, 0) scaleY(0)}50%{opacity:0.2;transform:translate(-50%, 100%) scaleY(1)}100%{opacity:0;transform:translate(-50%, 200%) scaleY(0)}}`)}function ri(t){let e,i,n,o,r,s,c,l,h,p,u,f,S,O,I;return{c(){e=H("div"),i=H("div"),n=me(),o=H("div"),r=H("i"),s=me(),c=H("i"),l=me(),h=H("i"),p=me(),u=H("div"),f=H("div"),Y(i,"class","PanoSpatialTagPlugin__tag-shadow svelte-vi2gid"),k(i,"transform","translate("+t[8]/2*t[3]*3+"px, "+t[9]/2*(t[1]?-1:1)*t[3]*3+"px) scale("+1/t[3]+")"),k(i,"background-image","url('"+t[7]+"')"),Y(r,"class","PanoSpatialTagPlugin__tag-flagpole svelte-vi2gid"),k(r,"width",t[4]+"rem"),Y(c,"class","PanoSpatialTagPlugin__tag-line1 svelte-vi2gid"),Y(h,"class","PanoSpatialTagPlugin__tag-line2 svelte-vi2gid"),Y(o,"class","PanoSpatialTagPlugin__tag-line svelte-vi2gid"),Y(f,"class","PanoSpatialTagPlugin__tag-content svelte-vi2gid"),Y(u,"class","PanoSpatialTagPlugin__tag-animate svelte-vi2gid"),k(u,"transform","scale("+t[3]*3+")"),Y(e,"id",S="PanoSpatialTagPlugin__"+t[0]),k(e,"height",20*t[5]+"rem"),Y(e,"class","svelte-vi2gid"),Z(e,"PanoSpatialTagPlugin__tag-x",!0),Z(e,"PanoSpatialTagPlugin__tag-upside-down",t[1]),Z(e,"PanoSpatialTagPlugin__tag-show",t[11]),Z(e,"PanoSpatialTagPlugin__tag-hide",t[11]===!1||t[6])},m(v,_){ye(v,e,_),z(e,i),z(e,n),z(e,o),z(o,r),z(o,s),z(o,c),z(o,l),z(o,h),z(e,p),z(e,u),z(u,f),f.innerHTML=t[2],t[17](f),O||(I=it(f,"click",t[12]),O=!0)},p(v,[_]){_&778&&k(i,"transform","translate("+v[8]/2*v[3]*3+"px, "+v[9]/2*(v[1]?-1:1)*v[3]*3+"px) scale("+1/v[3]+")"),_&128&&k(i,"background-image","url('"+v[7]+"')"),_&16&&k(r,"width",v[4]+"rem"),_&4&&(f.innerHTML=v[2]),_&8&&k(u,"transform","scale("+v[3]*3+")"),_&1&&S!==(S="PanoSpatialTagPlugin__"+v[0])&&Y(e,"id",S),_&32&&k(e,"height",20*v[5]+"rem"),_&2&&Z(e,"PanoSpatialTagPlugin__tag-upside-down",v[1]),_&2048&&Z(e,"PanoSpatialTagPlugin__tag-show",v[11]),_&2112&&Z(e,"PanoSpatialTagPlugin__tag-hide",v[11]===!1||v[6])},i:fe,o:fe,d(v){v&&Te(e),t[17](null),O=!1,I()}}}function li(t,e,i){let{id:n}=e,{upsideDown:o}=e,{content:r}=e,{contentZoom:s}=e,{lineWidthZoom:c}=e,{lineHeightZoom:l}=e,{destroying:h=!1}=e,{folded:p}=e,{dispose:u}=e,{events:f}=e,{hooks:S}=e,{blurImageUrl:O}=e,I=0,v=0,_,y,W=setTimeout(()=>{p||i(11,y=!0),W=void 0},100);const B=a=>{const L=Object.keys(f);let F=a.target;for(;F;){const U=F.getAttribute("class");if(!U){F=F.parentNode;continue}if(U.includes("PanoSpatialTagPlugin__tag-content")){F=null;break}L.forEach(J=>{U.includes(J)&&f[J](n)}),F=F.parentNode}};zt(()=>{S.emit("initTag",{id:n})});const ee=nt.subscribe(a=>{if(a===null)return;const[L,F]=a.split("-PanoSpatialTagPlugin-");n===L&&(S.emit("clickOrigin",{id:n,show:y}),W||(i(11,y=p),i(13,p=!p),W=setTimeout(()=>{W=void 0},1500)))});Yt(()=>{i(8,I=_.offsetWidth),i(9,v=_.offsetHeight),!W&&i(11,y=!p)}),Wt(()=>{S.emit("destroyTag",{id:n}),ee(),u()});function G(a){Nt[a?"unshift":"push"](()=>{_=a,i(10,_)})}return t.$$set=a=>{"id"in a&&i(0,n=a.id),"upsideDown"in a&&i(1,o=a.upsideDown),"content"in a&&i(2,r=a.content),"contentZoom"in a&&i(3,s=a.contentZoom),"lineWidthZoom"in a&&i(4,c=a.lineWidthZoom),"lineHeightZoom"in a&&i(5,l=a.lineHeightZoom),"destroying"in a&&i(6,h=a.destroying),"folded"in a&&i(13,p=a.folded),"dispose"in a&&i(14,u=a.dispose),"events"in a&&i(15,f=a.events),"hooks"in a&&i(16,S=a.hooks),"blurImageUrl"in a&&i(7,O=a.blurImageUrl)},[n,o,r,s,c,l,h,O,I,v,_,y,B,p,u,f,S,G]}class di extends Ke{constructor(e){super(),Qe(this,e,li,ri,et,{id:0,upsideDown:1,content:2,contentZoom:3,lineWidthZoom:4,lineHeightZoom:5,destroying:6,folded:13,dispose:14,events:15,hooks:16,blurImageUrl:7},si)}}const gi={position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",pointerEvents:"none"};var ci=Object.defineProperty,pi=(t,e,i)=>e in t?ci(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ie=(t,e,i)=>(pi(t,typeof e!="symbol"?e+"":e,i),i);const ze="<",Ye=">",We="%",Ne="locals",ui="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",mi={"&":"&amp","<":"&lt",">":"&gt",'"':"&#34","'":"&#39"},M={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};function Ze(t){return t.replace(/;(\s*$)/,"$1")}function fi(t,e){return new hi(t).compileFunction()(e)}class hi{constructor(e){ie(this,"templateText"),ie(this,"mode",null),ie(this,"truncate",!1),ie(this,"currentLine",1),ie(this,"source",""),ie(this,"regex",new RegExp(ui)),this.templateText=e}compileFunction(){let e;const i=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
  with (`+Ne+` || {}) {
`,n=`  }
  return __output;
`,o=function(r){return r==null?"":String(r).replace(/[&<>'"]/g,function(s){return mi[s]||s})};return this._generateSource(),this.source=i+this.source+n,e=this.source,e="escapeFn = escapeFn || "+o.toString()+`;
`+e,new Function(Ne+", escapeFn",e)}_generateSource(){this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");const e=this._parseTemplateText(),i=We,n=ze,o=Ye;e&&e.length&&e.forEach((r,s)=>{let c;if(r.indexOf(n+i)===0&&r.indexOf(n+i+i)!==0&&(c=e[s+2],!(c==i+o||c=="-"+i+o||c=="_"+i+o)))throw new Error('Could not find matching close tag for "'+r+'".');this._scanLine(r)})}_parseTemplateText(){let e=this.templateText;const i=this.regex;let n=i.exec(e);const o=[];let r;for(;n;)r=n.index,r!==0&&(o.push(e.substring(0,r)),e=e.slice(r)),o.push(n[0]),e=e.slice(n[0].length),n=i.exec(e);return e&&o.push(e),o}_addOutput(e){if(this.truncate&&(e=e.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!e)return e;e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/\r/g,"\\r"),e=e.replace(/"/g,'\\"'),this.source+='    ; __append("'+e+`")
`}_scanLine(e){const i=We,n=ze,o=Ye;switch(e.split(`
`).length-1,e){case n+i:case n+i+"_":this.mode=M.EVAL;break;case n+i+"=":this.mode=M.ESCAPED;break;case n+i+"-":this.mode=M.RAW;break;case n+i+"#":this.mode=M.COMMENT;break;case n+i+i:this.mode=M.LITERAL,this.source+='    ; __append("'+e.replace(n+i+i,n+i)+`")
`;break;case i+i+o:this.mode=M.LITERAL,this.source+='    ; __append("'+e.replace(i+i+o,i+o)+`")
`;break;case i+o:case"-"+i+o:case"_"+i+o:this.mode==M.LITERAL&&this._addOutput(e),this.mode=null,this.truncate=e.indexOf("-")===0||e.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case M.EVAL:case M.ESCAPED:case M.RAW:e.lastIndexOf("//")>e.lastIndexOf(`
`)&&(e+=`
`)}switch(this.mode){case M.EVAL:this.source+="    ; "+e+`
`;break;case M.ESCAPED:this.source+="    ; __append(escapeFn("+Ze(e)+`))
`;break;case M.RAW:this.source+="    ; __append("+Ze(e)+`)
`;break;case M.COMMENT:break;case M.LITERAL:this._addOutput(e);break}}else this._addOutput(e)}}}const _e=.001,He=.01,Be=Mt,vi=(t,e)=>{var i,n,o,r,s,c,l,h;let p=e==null?void 0:e.container,u=1.4;const f=(i=e==null?void 0:e.wait)!=null?i:200,S=(n=e==null?void 0:e.maxNumberOnScreen)!=null?n:3,O=(o=e==null?void 0:e.minRad)!=null?o:Math.PI/4,I=(r=e==null?void 0:e.nearTolerance)!=null?r:100,v=(s=e==null?void 0:e.upsideHeight)!=null?s:1.6,_=(c=e==null?void 0:e.minDistance)!=null?c:1.2,y=(l=e==null?void 0:e.maxDistance)!=null?l:3.5,W=ti(t),B=document.createElement("div");B.classList.add("PanoSpatialTagPlugin"),Object.assign(B.style,gi);const ee=new _t;let G=new Image;G.src=Be;const a={points:[],origins:[],tags:[],template:"",events:{},render:fi,folded:!1,enabled:!0,forbidden:!0},L=new oi({target:B,props:{origins:a.origins}}),F=(d,b)=>{T(),b&&C()},U=()=>{a.forbidden&&(a.forbidden=!1,C())},J=(d,b)=>{if(a.tags.length===0)return;const $=b.longitude-t.state.longitude,g=t.camera.clone();g.position.copy(b.offset),g.rotateOnWorldAxis(new D(0,1,0),$),g.updateProjectionMatrix(),g.updateMatrixWorld(!0);const q=new $e,oe=new Oe;oe.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),q.setFromProjectionMatrix(oe),a.tags.forEach(P=>{const pe=g.position.clone().setY(u).distanceTo(P.position);if(pe<_||pe>y||!q.containsPoint(P.position))return P.destroying=!0;const se=P.position.clone().sub(g.position).setY(0);if(se.angleTo(P.normal)>Math.PI/2-O&&se.angleTo(P.normal)<Math.PI/2+O)return P.destroying=!0}),a.tags.forEach(P=>{P.destroying?P.app.$set({contentZoom:.1+g.position.distanceTo(P.position)/y,lineWidthZoom:.38*(.01+g.position.distanceTo(P.position)/y),destroying:P.destroying}):P.app.$set({lineWidthZoom:.38*(.01+g.position.distanceTo(P.position)/y),lineHeightZoom:.4+(g.position.distanceTo(P.position)-_)/y*.6,contentZoom:.1+g.position.distanceTo(P.position)/y})}),setTimeout(()=>{a.tags.forEach(P=>{P.destroying&&(P.app.$destroy(),P=null)}),a.tags=a.tags.filter(P=>!P.destroying),T()},1900)},m=d=>{d!==be.Mode.Panorama&&!a.forbidden&&(L.$set({origins:[]}),a.tags.forEach(b=>{b.app.$destroy(),b=null}),a.origins=[],a.tags=[],a.forbidden=!0)},T=()=>{if(a.forbidden||!a.enabled)return;const d=t.camera,b=d.getWorldDirection(new D);a.origins=a.tags.map($=>{const g=$.position.clone().project(d),q=$.position.clone().sub(d.position).setY(0).angleTo(b.setY(0))<Math.PI/2;return{id:$.id,front:q,left:(g.x+1)/2*100,top:(-g.y+1)/2*100,destroying:$.destroying}}),L.$set({origins:a.origins})},C=()=>{a.forbidden||!a.enabled||(a.timeoutId&&clearTimeout(a.timeoutId),a.timeoutId=setTimeout(()=>{a.timeoutId=void 0;const d=R();d.length&&(a.tags=a.tags.concat(d),T())},f))},R=()=>{const{clientWidth:d,clientHeight:b}=t.getElement(),$=[],g=t.camera,q=new $e,oe=new Oe,P=g.getWorldDirection(new D);oe.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),q.setFromProjectionMatrix(oe);const pe=a.tags.filter(E=>q.containsPoint(E.position)&&!E.destroying).length,se=a.points.reduce((E,j)=>{if(a.tags.find(x=>j.id===x.id&&!x.destroying))return E;const N=g.position.clone().setY(u).distanceTo(j.position);if(N<_||N>y||!q.containsPoint(j.position))return E;const re=j.position.clone().sub(g.position).setY(0);if(re.angleTo(j.normal)>Math.PI/2-O&&re.angleTo(j.normal)<Math.PI/2+O)return E;const te=j.position.clone().project(g);if(!a.tags.every(x=>{if(x.position.clone().sub(g.position).setY(0).angleTo(P.setY(0))>Math.PI/2)return!0;const K=x.position.clone().project(g);return Math.sqrt(Math.pow((te.x-K.x)/2*d,2)+Math.pow((te.y-K.y)/2*b,2))>I}))return E;const X={id:j.id,position:j.position,normal:j.normal,replacement:j.replacement,weight:j.weight,distance:N};let w;for(let x=0,K=E.length;x<K;x++){const ue=E[x];if(X.weight>ue.weight){w=x;break}if(X.distance<ue.distance){w=x;break}}return w!==void 0?E.splice(w,0,X):E.push(X),E},[]);for(let E=0,j=se.length;E<j&&!(pe+$.length>=S);E++){const N=se[E];if($.find(w=>N.id===w.id))continue;const re=N.position.clone().project(g);if(!a.tags.concat($).every(w=>{if(w.position.clone().sub(g.position).setY(0).angleTo(P.setY(0))>Math.PI/2)return!0;const x=w.position.clone().project(g);return Math.sqrt(Math.pow((re.x-x.x)/2*d,2)+Math.pow((re.y-x.y)/2*b,2))>I}))continue;const te=new bt(g.position.clone().setY(u),N.position.clone().sub(g.position.clone().setY(u)).normalize(),0,N.distance+He),[X]=a.intersectObjects?te.intersectObjects(a.intersectObjects,!0):t.model.loaded?t.model.intersectRaycaster(te):te.intersectObjects(t.model.children,!0);if(X&&N.distance-X.distance<He){const{position:w,normal:x,id:K,replacement:ue}=N,st=new wt().setFromNormalAndCoplanarPoint(x,w),xe=w.clone().sub(g.position).cross(new D(0,1,0)).setLength(_e),rt=[w.clone(),w.clone().add(xe),w.clone().add(new D(0,_e,0)).add(xe),w.clone().add(new D(0,_e,0))].map(ct=>st.projectPoint(ct,new D)),{container:lt,dispose:dt}=W.create3DDomContainer(rt)||{},gt=new di({target:lt,props:{id:K,content:a.render(a.template,ue),lineWidthZoom:.38*(.01+g.position.distanceTo(w)/y),lineHeightZoom:.4+(g.position.distanceTo(w)-_)/y*.6,contentZoom:.1+g.position.distanceTo(w)/y,upsideDown:w.y>v,folded:a.folded,events:a.events,hooks:ee,dispose:dt,blurImageUrl:Be}});$.push({position:w,normal:x,id:K,app:gt})}}return $},de=d=>{a.points=d.points.map(b=>{var $,g;return{id:b.id,position:new D().fromArray(b.position),normal:new D().fromArray(b.normal),replacement:($=b.replacement)!=null?$:{},weight:(g=b.weight)!=null?g:-1}}),d.render&&(a.render=d.render),d.template&&(a.template=d.template),d.events&&(a.events=d.events),d.enabled===!1&&(a.enabled=d.enabled),d.folded===!0&&(a.folded=d.folded)},V=d=>{a.intersectObjects=d,C()},A=()=>{a.enabled=!0,C()},ge=()=>{a.enabled=!1,L.$set({origins:[]}),a.tags.forEach(d=>{d.app.$destroy(),d=null}),a.origins=[],a.tags=[]},ne=()=>{a.folded=!1,a.tags.forEach(d=>{d.app.$set({folded:a.folded})})},he=()=>{a.folded=!0,a.tags.forEach(d=>{d.app.$set({folded:a.folded})})},ce=d=>{a.tags.forEach(b=>{b.id===d&&b.app.$set({folded:!1})})},ot=d=>{a.tags.forEach(b=>{b.id===d&&b.app.$set({folded:!0})})},Se=()=>{t.once("renderFrame",T)},ve=()=>{p||(p=t.getElement().parentElement),p&&p.appendChild(B),a.forbidden=!1,u=t.model.bounding.getCenter(new D).y,C(),t.on("panoWillArrive",J),t.on("panoArrived",U),t.on("modeChange",m),t.on("cameraUpdate",F)},Pe=()=>{G=null,W.disposeAll(),L.$destroy(),a.tags.forEach(d=>{d.app.$destroy(),d=null}),a.origins=[],a.tags=[],t.off("modelLoaded",ve),t.off("renderFrame",T),t.off("panoWillArrive",J),t.off("panoArrived",U),t.off("modeChange",m),t.off("cameraUpdate",F),t.off("dispose",Pe),window.removeEventListener("resize",Se,!1)};return window.addEventListener("resize",Se,!1),(h=t==null?void 0:t.model)!=null&&h.loaded?ve():t.once("modelLoaded",ve),t.on("dispose",Pe),{load:de,setIntersectObjects:V,unfoldAll:ne,foldAll:he,unfold:ce,fold:ot,enable:A,disable:ge,hooks:ee,dispose:Pe}};function Ue(){return{width:window.innerWidth,height:window.innerHeight}}function Pi(){const[t,e]=le.useState(Ue);return le.useEffect(()=>{const i=()=>e(Ue());return window.addEventListener("resize",i,!1),()=>window.removeEventListener("resize",i,!1)}),t}const _i=()=>{const[t,e]=yt(),i=Ge(),n=le.useRef(null),o=Tt();return le.useEffect(()=>{!n.current||t.mode!==be.Mode.Panorama||i.plugins.modelViewPlugin.appendTo(n.current,{width:90,height:120})},[t.mode,o]),t.mode!==be.Mode.Panorama||o!=="Loaded"?null:ae.jsx(Ct,{onClick:()=>e({mode:"Floorplan"}),sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"110px",height:"140px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, .2)"},ref:n})},bi=()=>{const t=Ge(),e=Je(Xe.MODEL_TAG,"81gmMq5eXl5I9y7JMk");return le.useEffect(()=>{if(!e)return;const i=e.map(n=>{const{id:o,position:r,normal:s,weight:c,name:l,price:h,brand:p}=n;return{id:o,position:r,normal:s,weight:c,replacement:{name:l,price:h,brand:p}}});t.plugins.panoSpatialTagPlugin.load({points:i,template:`
            <div class="tag-wrapper" style="pointer-events: auto;">
              <%if (brand) {%><div style="background:url('//vr-static.realsee-cdn.cn/release/web/brand_bg.15e354d0.png') no-repeat;background-size:100% 100%;box-shadow: 0 -0.625rem 0.625rem 0 rgba(0, 0, 0, 0.1);
                border-radius: 0.0625rem;overflow: hidden;font-size: 0.6875rem;padding:0.125rem;width:max-content;margin-bottom:0.375rem;line-height:1;">
                <%= brand %>
              </div><% } %>
              <div style="max-width:7rem;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;line-height:1;margin-bottom:0.375rem;"><%= name %></div>
              <%if (price) {%><div style="display:flex;align-items:center;font-family: Helvetica;font-size: 0.9375rem;font-weight:600;line-height:1;color: #ffdda1;text-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.1);">
                <svg height="12" viewBox="0 0 10 12" width="10" xmlns="http://www.w3.org/2000/svg">
                  <path d="m6.30970149 6.49402985h1.82910448v1.2761194h-2.12686567v3.50223885h-2.45298508v-3.50223885h-2.12686567v-1.2761194h1.82910448l-3.26119403-6.49402985h2.60895522l2.16940299 5.3738806 2.2119403-5.3738806h2.50970149z" fill="#ffdda1" transform="translate(.182 .682)"/>
                </svg>
                <span><%= price %></span>
              </div>
              <% } %>
            </div>`,events:{"tag-wrapper":n=>{t.plugins.panoSpatialTagPlugin.fold(n)}}})},[e]),null},wi={},Ve=jt(),qe=JSON.stringify(Ve)!=="{}"?Ve:wi,yi=St({plugins:[[vi,"panoSpatialTagPlugin",{...qe}],[qt,"modelViewPlugin",{...qe}]]}),Ti=()=>{const t=Pi(),e=Je(Xe.WORK,"81gmMq5eXl5I9y7JMk");return e&&ae.jsxs(yi,{initialWork:xt(e),children:[ae.jsx(Et,{...t}),ae.jsx(bi,{}),ae.jsx(_i,{})]})};kt.render(ae.jsx(Ti,{}),document.querySelector("#app"));
