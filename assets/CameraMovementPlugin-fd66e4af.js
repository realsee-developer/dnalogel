import{F as h,r as P,q as D,j as u,G as _,I as W,a as z}from"./index-85b64ddc.js";import"./index-62a9cd62.js";import{B as U}from"./Box-d96aca33.js";import{P as B}from"./Paper-ead7a250.js";import{B as F}from"./ButtonGroup-da6043f4.js";import{B as g}from"./Button-c89038b2.js";import{u as K,D as q}from"./useFetchDatas-45e33e50.js";import{M as G,y as L}from"./Point-d3172315.js";import{T as V,l as H}from"./index-32625078.js";import"./createTheme-a7bd8e9d.js";import"./useTheme-28230d65.js";import"./ButtonBase-4df208c3.js";const Y=L;function J(e,o,t,c=Y.Linear.None){const a=new G(e).to(o,t).easing(c);V(()=>a.start(0));const r=H(n=>{a.update(n)===!1&&r()}),i=[];return a.onDestroy=n=>(i.push(n),a),a.destroy=function(){this.stop(),Object.assign(a,{_onStartCallback:null,_onUpdateCallback:null,_onCompleteCallback:null,_onStopCallbackL:null});let n;for(;n=i.shift();)n();r()},a}function Q(e,o){return J({progress:0},{progress:1},e,o)}var d=(e=>(e.Clockwise="Clockwise",e.Anticlockwise="Anticlockwise",e.Loop="Loop",e))(d||{});const y=Math.PI*2;function O(e){return(e%y+y)%y}function E(e){return e%y}function b(e,o,t){return e+(o-e)*t}var X=Object.defineProperty,M=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,S=(e,o,t)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,ee=(e,o)=>{for(var t in o||(o={}))Z.call(o,t)&&S(e,t,o[t]);if(M)for(var t of M(o))$.call(o,t)&&S(e,t,o[t]);return e},j=(e,o,t)=>new Promise((c,a)=>{var r=s=>{try{n(t.next(s))}catch(l){a(l)}},i=s=>{try{n(t.throw(s))}catch(l){a(l)}},n=s=>s.done?c(s.value):Promise.resolve(s.value).then(r,i);n((t=t.apply(e,o)).next())});const w=(e,o,t)=>{const c=Math.PI,a=c*2;let r=O(e),i=O(o);return t===d.Anticlockwise&&r<i&&(r+=a),t===d.Clockwise&&i<r&&(i+=a),t===d.Loop&&i-r>c?w(r,i,d.Anticlockwise):t===d.Loop&&r-i>c?w(r,i,d.Clockwise):{from:r,to:i}},oe=e=>{const o={},t=(a,r,...i)=>j(void 0,[a,r,...i],function*(n,s,l={preload:!0}){return o.interruptCallback&&o.interruptCallback(!1),l.asyncStartCallback&&(yield l.asyncStartCallback()),n.mode&&n.mode!==e.currentMode&&(yield e.changeMode(n.mode)),l.preload&&n.panoIndex!==void 0&&n.panoIndex!==e.panoIndex&&(yield e.preloadPano(n.panoIndex)),l.asyncEndCallback&&(yield l.asyncEndCallback()),n.panoIndex===void 0&&n.fov===void 0&&n.latitude===void 0&&n.longitude===void 0?!0:yield new Promise((v,p)=>{const m=n.panoIndex!==void 0?n.panoIndex:e.panoIndex;m!==void 0?e.moveToPano(m,ee({duration:s,moveEndCallback:()=>v(!0),moveCancelCallback:()=>p(new Error("move canceled"))},n)):p(new Error("unexpected error"))})}),c=a=>{const r=e.state,i=E(r.latitude),n=E(a.latitude),{from:s,to:l}=w(r.longitude,a.longitude,a.rotation||d.Loop),v=r.fov,p=a.fov;return{from:{latitude:i,longitude:s,fov:v},to:{latitude:n,longitude:l,fov:p}}};return{move:t,rotate:(a,r,...i)=>j(void 0,[a,r,...i],function*(n,s,l={}){o.interruptCallback&&o.interruptCallback(!1),l.asyncStartCallback&&(yield l.asyncStartCallback()),e.currentMode!==h.Mode.Panorama&&(yield e.changeMode(h.Mode.Panorama)),n.panoIndex!==void 0&&n.panoIndex!==e.panoIndex&&(l.preload&&(yield e.preloadPano(n.panoIndex)),yield new Promise((m,x)=>{if(!n.panoIndex){m(!0);return}e.moveToPano(n.panoIndex,{moveEndCallback:()=>m(!0),moveCancelCallback:()=>x(new Error("move canceled"))})})),l.asyncEndCallback&&(yield l.asyncEndCallback());const{from:v,to:p}=c(n);return yield new Promise(m=>{const x=({progress:f})=>{const C={};C.longitude=b(v.longitude,p.longitude,f),C.latitude=b(v.latitude,p.latitude,f),C.fov=b(v.fov,p.fov,f),e.setState(C,!0)},A=()=>{m(!0)},N=()=>{m(!1)},R=n.rotateSpeed?Math.ceil(Math.abs(p.longitude-v.longitude)/n.rotateSpeed*1e3):s,I=Q(R,L.Linear.None).onUpdate(x).onComplete(A).onDestroy(N);n.rotation===d.Loop&&I.repeat(1/0).yoyo(!0),o.interruptCallback=(f=!0)=>{I.destroy(),o.interruptCallback=void 0,o.timeoutId&&(clearTimeout(o.timeoutId),o.timeoutId=void 0),m(f)},o.timeoutId=setTimeout(()=>{o.interruptCallback&&o.interruptCallback(!0)},s)})})}};function T(){return{width:window.innerWidth,height:window.innerHeight}}function ne(){const[e,o]=P.useState(T);return P.useEffect(()=>{const t=()=>o(T());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),e}const k={PANO_MOVE:{fov:98,panoIndex:1,latitude:-.007769878726327784,longitude:4.614049904222785},CLOCKWISE_ROTATION:{fov:50,latitude:.0340522133938706,longitude:.1257016521296519,rotation:d.Anticlockwise},COUNTERCLOCKWISE_ROTATION:{fov:50,latitude:.0340522133938706,longitude:.1257016521296519,rotation:d.Clockwise},ROUND:{fov:50,latitude:-.0004827098383655415,longitude:1.264471004436043,rotateSpeed:.25,rotation:d.Loop}},te=e=>{const o=D(),t=(a,r=1e4)=>{o.plugins.cameraMovementPlugin.move(a,r)},c=(a,r=1e4)=>{o.plugins.cameraMovementPlugin.rotate(a,r)};return u.jsx(U,{children:u.jsx(B,{sx:{position:"fixed",top:"10px",right:"10px",backgroundColor:"transparent"},children:u.jsxs(F,{size:"large","aria-label":"large button group",orientation:"vertical",children:[u.jsx(g,{onClick:()=>t(k.PANO_MOVE),children:"点位游走"}),u.jsx(g,{onClick:()=>c(k.CLOCKWISE_ROTATION),children:"顺时针旋转"}),u.jsx(g,{onClick:()=>c(k.COUNTERCLOCKWISE_ROTATION),children:"逆时针旋转"}),u.jsx(g,{onClick:()=>c(k.ROUND,2e4),children:"来回旋转"})]})})})},ae=_({onlyRenderIfNeeds:!0,imageOptions:{size:512},textureOptions:{size:512},plugins:[[oe,"cameraMovementPlugin",{}]]}),re=()=>{const e=ne(),o=K(q.WORK);return o&&u.jsxs(ae,{initialWork:o,children:[u.jsx(W,{...e}),u.jsx(te,{})]})};z.render(u.jsx(re,{}),document.querySelector("#app"));
