import{H as N,V as W,l as $,K as k,D as U,r as S,J as B,q as J,n as V,X as H,j as s,F as G,G as K,p as X,I as Y,b as Q}from"./index-85b64ddc.js";import{v as Z,s as ee}from"./index-62a9cd62.js";import{d as ne,a as oe}from"./ViewInAr-fd4fa02b.js";import{u as q,D as T}from"./useFetchDatas-45e33e50.js";import{P as te}from"./Paper-ead7a250.js";import{B as ie,a as O}from"./BottomNavigationAction-2b30d94e.js";import{g as re}from"./getInitialParamFromUrl-5dd39f79.js";import{O as ae}from"./transformToMeshBasicMaterial-58f46ad3.js";import"./Point-d3172315.js";import"./createTheme-a7bd8e9d.js";import"./createSvgIcon-c7bdef24.js";import"./createSvgIcon-0da8929c.js";import"./ButtonBase-4df208c3.js";import"./useControlled-e139503c.js";import"./useId-457cb0cd.js";function le(o,n){var t,d,i,e,c;const a=(t=n==null?void 0:n.size)!=null?t:512,l=(d=n==null?void 0:n.fontSize)!=null?d:a*(35/256)*1.2,f=(i=n==null?void 0:n.backgroundColor)!=null?i:"rgba(0,0,0,0)",y=(e=n==null?void 0:n.fontColor)!=null?e:"#fff",F=(c=n==null?void 0:n.textAlign)!=null?c:"center",g=document.createElement("canvas");g.setAttribute("width",a+""),g.setAttribute("height",a+"");const u=g.getContext("2d");return u.fillStyle=f,u.fillRect(0,0,a,a),u.font=`${l}px "微软雅黑"`,u.textAlign=F,u.fillStyle=y,u.fillText(o,a/2,a*.7),new N(g)}const se=({x:o,y:n,z:t})=>new W(o,n,t);var de=(o,n,t)=>new Promise((d,i)=>{var e=l=>{try{a(t.next(l))}catch(f){i(f)}},c=l=>{try{a(t.throw(l))}catch(f){i(f)}},a=l=>l.done?d(l.value):Promise.resolve(l.value).then(e,c);a((t=t.apply(o,n)).next())});const ue=(o,n)=>{var t,d,i;const e={},c=(t=n==null?void 0:n.animationEnabled)!=null?t:!0,a=(d=n==null?void 0:n.position)!=null?d:void 0,l=(i=n==null?void 0:n.rad)!=null?i:void 0,f=(n==null?void 0:n.fbx_url)||Z,y=[],F=r=>de(void 0,null,function*(){var m,x,p,P,A,h,j,D;const E=(m=r==null?void 0:r.position)!=null?m:a;if(!E)return Promise.reject(new Error("ModelEntryDoorGuidePlugin.load(): position is undefined"));const M=se(E),v=(x=r==null?void 0:r.rad)!=null?x:l,z=(p=r==null?void 0:r.fbx_url)!=null?p:f;if(e.rad=v,v===void 0)return Promise.reject(new Error(`ModelEntryDoorGuidePlugin.load(): rad is ${v}`));const b=yield new ee().loadAsync(z);b.position.copy(M),b.rotation.z=v,b.scale.set(.8,.8,.8),ae(b,{transparent:!0,side:U});const w=(j=(h=(A=(P=b.children)==null?void 0:P[0])==null?void 0:A.children)==null?void 0:h[3])==null?void 0:j.clone();if(!w)return Promise.reject(new Error(`ModelEntryDoorGuidePlugin.load(): textMesh is ${w}`));const I=(D=n.name)!=null?D:"入户门";return w.material=new $({transparent:!0,map:le(I)}),w.renderOrder=3,b.children[0].add(w),e.object=b,!0}),g=()=>{if(e.animation)return;if(!e.object)return console.error("ModelEntryDoorGuidePlugin.initAnimation(): state.object is ",e.object);const r=1,m=new k(e.object);y.push(m);const x=m.clipAction(e.object.animations[0]);x.timeScale=r;let p;const P=()=>{let h=0,j=0;const D=1e3/30,E=M=>{h=requestAnimationFrame(E);const v=M-j;v<D||(j=M,y.forEach(z=>z.update(v/1e3)),o.needsRender=!0)};return h=requestAnimationFrame(E),()=>{cancelAnimationFrame(h)}},A={play:()=>{p||(x.play(),p=P(),requestAnimationFrame(()=>{e.object&&e.object.rotation.z!==e.rad&&(e.object.rotation.z=e.rad)}))},stop:()=>{x.stop(),p==null||p(),p=void 0}};e.animation=A},u=r=>{var m;if(!e.object)return console.error("ModelEntryDoorGuidePlugin.enable(): object is ",e.object);((m=r==null?void 0:r.animationEnable)!=null?m:c)&&(e.animation||g(),e.animation.play()),o.scene.add(e.object),o.needsRender=!0},R=()=>{e.object&&(e.animation&&e.animation.stop(),o.scene.remove(e.object),o.needsRender=!0)},_=r=>r==="Floorplan"?u():R();return{load:F,enable:r=>(e.enabled||(e.enabled=!0,_(o.currentMode),o.on("modeChange",_),u(r)),!0),disable:()=>(e.enabled&&(e.enabled=!1,R(),o.off("modeChange",_)),!0)}};function C(){return{width:window.innerWidth,height:window.innerHeight}}function ce(){const[o,n]=S.useState(C);return S.useEffect(()=>{const t=()=>n(C());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),o}const me=()=>{const[o,n]=B(),t=J(),d=V(),i=q(T.MODEL_ENTRY_DOOR_GUIDE_PLUGIN_SERVER_DATA);return H("modelLoaded",async()=>{if(!i||JSON.stringify(i)==="{}")return;const e={fbx_url:"//vr-public.realsee-cdn.cn/release/web/entryDoorMini/Anim_Door1.fbx",position:i==null?void 0:i.position,rad:i==null?void 0:i.rad};await t.plugins.modelEntryDoorGuidePlugin.load(e),n({mode:G.Mode.Floorplan,fov:80,latitude:-.06631286321852166,longitude:2.424613849671955,panoIndex:0}),t.plugins.modelEntryDoorGuidePlugin.enable({animationEnable:!1})},[i]),d!=="Loaded"?null:s.jsx(te,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:s.jsxs(ie,{showLabels:!0,value:o.mode,onChange:(e,c)=>{n({mode:c})},children:[s.jsx(O,{label:"全景漫游",icon:s.jsx(ne,{}),value:G.Mode.Panorama}),s.jsx(O,{label:"空间总览",icon:s.jsx(oe,{}),value:G.Mode.Floorplan})]})})},pe={name:"入户门"},L=re(),fe=JSON.stringify(L)!=="{}"?L:pe,ve=K({imageOptions:{size:512},textureOptions:{size:512},plugins:[[ue,"modelEntryDoorGuidePlugin",{...fe}]]}),be=()=>{const o=ce(),n=q(T.WORK);return n&&s.jsxs(ve,{initialWork:X(n),children:[s.jsx(Y,{...o}),s.jsx(me,{})]})};Q.render(s.jsx(be,{}),document.querySelector("#app"));
