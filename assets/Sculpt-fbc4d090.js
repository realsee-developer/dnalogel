import{r as X,j as P,q as rn,m as Nt,V as z,aZ as Jt,P as di,aT as Mt,bm as zn,aj as Wn,b5 as en,bn as hi,M as be,l as Ye,v as Un,be as an,S as fi,g as jt,aM as Hn,ba as mi,bo as je,bp as Fe,aU as Pn,bq as Mn,d as Vt,B as vi,b6 as gi,a_ as yi,aF as bi,aE as wi,aI as xi,aG as Ci,Z as Ti,aN as Ei,u as Sn,br as Pi,H as Mi,L as Si,bs as ki,D as Ai,c as Ce,G as Oi,p as ji,I as Fi,a as Li}from"./index-85b64ddc.js";import{f as At,d as Ni,x as Ii}from"./index-95a52a8f.js";import{F as _i}from"./FiveModeSwitcher-1248bc03.js";import{a as ut,g as pt,_ as ee,f as Ge,c as dt,d as ht,i as Ri}from"./createTheme-a7bd8e9d.js";import{i as Xt,r as Di}from"./createSvgIcon-c7bdef24.js";import{P as tn}from"./Paper-ead7a250.js";import{B as at}from"./ButtonGroup-da6043f4.js";import{B as $}from"./Button-c89038b2.js";import{i as Bi,a as kn,S as zi,I as Wi,F as Ui,O as Hi,M as Yi}from"./Select-3fe0d82f.js";import{B as st}from"./Box-d96aca33.js";import{s as $e,b as ft,d as mt,r as Vi}from"./ButtonBase-4df208c3.js";import{F as Xi,u as sn}from"./useFormControl-02fd8567.js";import{u as qi}from"./useId-457cb0cd.js";import{f as ln}from"./formControlState-a1fb9590.js";import{F as An,O as Ve,z as Yn}from"./Point-d3172315.js";import{T as nt}from"./Typography-c2c598f0.js";import{S as qt}from"./Switch-96b748b5.js";import{S as On}from"./Slider-ccde2988.js";import{S as jn}from"./Stack-c2a4c269.js";import{u as Gi,D as $i}from"./useFetchDatas-45e33e50.js";import"./_five-e7379201.js";import{T as Ki,t as Zi}from"./theme-ab018eed.js";import"./BottomNavigationAction-2b30d94e.js";import"./createSvgIcon-0da8929c.js";import"./useControlled-e139503c.js";import"./index-16229650.js";import"./resolveComponentProps-e8e495ed.js";import"./List-18d2735b.js";import"./useTheme-28230d65.js";import"./useSlotProps-f647abdb.js";import"./GlobalStyles-046f73a8.js";import"./SwitchBase-46ff3440.js";function Qi(a){return ut("MuiFormControl",a)}pt("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Ji=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],eo=a=>{const{classes:o,margin:e,fullWidth:i}=a,t={root:["root",e!=="none"&&`margin${Ge(e)}`,i&&"fullWidth"]};return mt(t,Qi,o)},to=$e("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:a},o)=>ee({},o.root,o[`margin${Ge(a.margin)}`],a.fullWidth&&o.fullWidth)})(({ownerState:a})=>ee({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},a.margin==="normal"&&{marginTop:16,marginBottom:8},a.margin==="dense"&&{marginTop:8,marginBottom:4},a.fullWidth&&{width:"100%"})),no=X.forwardRef(function(o,e){const i=ft({props:o,name:"MuiFormControl"}),{children:t,className:l,color:u="primary",component:c="div",disabled:m=!1,error:d=!1,focused:f,fullWidth:y=!1,hiddenLabel:x=!1,margin:E="none",required:M=!1,size:S="medium",variant:O="outlined"}=i,T=dt(i,Ji),g=ee({},i,{color:u,component:c,disabled:m,error:d,fullWidth:y,hiddenLabel:x,margin:E,required:M,size:S,variant:O}),C=eo(g),[p,w]=X.useState(()=>{let Q=!1;return t&&X.Children.forEach(t,q=>{if(!Xt(q,["Input","Select"]))return;const L=Xt(q,["Select"])?q.props.input:q;L&&Bi(L.props)&&(Q=!0)}),Q}),[k,te]=X.useState(()=>{let Q=!1;return t&&X.Children.forEach(t,q=>{Xt(q,["Input","Select"])&&(kn(q.props,!0)||kn(q.props.inputProps,!0))&&(Q=!0)}),Q}),[Z,ne]=X.useState(!1);m&&Z&&ne(!1);const re=f!==void 0&&!m?f:Z;let pe;const ve=X.useMemo(()=>({adornedStart:p,setAdornedStart:w,color:u,disabled:m,error:d,filled:k,focused:re,fullWidth:y,hiddenLabel:x,size:S,onBlur:()=>{ne(!1)},onEmpty:()=>{te(!1)},onFilled:()=>{te(!0)},onFocus:()=>{ne(!0)},registerEffect:pe,required:M,variant:O}),[p,u,m,d,k,re,y,x,pe,M,S,O]);return P.jsx(Xi.Provider,{value:ve,children:P.jsx(to,ee({as:c,ownerState:g,className:ht(C.root,l),ref:e},T,{children:t}))})}),io=no;function oo(a){return ut("MuiFormHelperText",a)}const ro=pt("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]),Fn=ro;var Ln;const ao=["children","className","component","disabled","error","filled","focused","margin","required","variant"],so=a=>{const{classes:o,contained:e,size:i,disabled:t,error:l,filled:u,focused:c,required:m}=a,d={root:["root",t&&"disabled",l&&"error",i&&`size${Ge(i)}`,e&&"contained",c&&"focused",u&&"filled",m&&"required"]};return mt(d,oo,o)},lo=$e("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(a,o)=>{const{ownerState:e}=a;return[o.root,e.size&&o[`size${Ge(e.size)}`],e.contained&&o.contained,e.filled&&o.filled]}})(({theme:a,ownerState:o})=>ee({color:(a.vars||a).palette.text.secondary},a.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${Fn.disabled}`]:{color:(a.vars||a).palette.text.disabled},[`&.${Fn.error}`]:{color:(a.vars||a).palette.error.main}},o.size==="small"&&{marginTop:4},o.contained&&{marginLeft:14,marginRight:14})),co=X.forwardRef(function(o,e){const i=ft({props:o,name:"MuiFormHelperText"}),{children:t,className:l,component:u="p"}=i,c=dt(i,ao),m=sn(),d=ln({props:i,muiFormControl:m,states:["variant","size","disabled","error","filled","focused","required"]}),f=ee({},i,{component:u,contained:d.variant==="filled"||d.variant==="outlined",variant:d.variant,size:d.size,disabled:d.disabled,error:d.error,filled:d.filled,focused:d.focused,required:d.required}),y=so(f);return P.jsx(lo,ee({as:u,ownerState:f,className:ht(y.root,l),ref:e},c,{children:t===" "?Ln||(Ln=P.jsx("span",{className:"notranslate",children:"​"})):t}))}),uo=co;function po(a){return ut("MuiFormLabel",a)}const ho=pt("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),lt=ho,fo=["children","className","color","component","disabled","error","filled","focused","required"],mo=a=>{const{classes:o,color:e,focused:i,disabled:t,error:l,filled:u,required:c}=a,m={root:["root",`color${Ge(e)}`,t&&"disabled",l&&"error",u&&"filled",i&&"focused",c&&"required"],asterisk:["asterisk",l&&"error"]};return mt(m,po,o)},vo=$e("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:a},o)=>ee({},o.root,a.color==="secondary"&&o.colorSecondary,a.filled&&o.filled)})(({theme:a,ownerState:o})=>ee({color:(a.vars||a).palette.text.secondary},a.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${lt.focused}`]:{color:(a.vars||a).palette[o.color].main},[`&.${lt.disabled}`]:{color:(a.vars||a).palette.text.disabled},[`&.${lt.error}`]:{color:(a.vars||a).palette.error.main}})),go=$e("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(a,o)=>o.asterisk})(({theme:a})=>({[`&.${lt.error}`]:{color:(a.vars||a).palette.error.main}})),yo=X.forwardRef(function(o,e){const i=ft({props:o,name:"MuiFormLabel"}),{children:t,className:l,component:u="label"}=i,c=dt(i,fo),m=sn(),d=ln({props:i,muiFormControl:m,states:["color","required","focused","disabled","error","filled"]}),f=ee({},i,{color:d.color||"primary",component:u,disabled:d.disabled,error:d.error,filled:d.filled,focused:d.focused,required:d.required}),y=mo(f);return P.jsxs(vo,ee({as:u,ownerState:f,className:ht(y.root,l),ref:e},c,{children:[t,d.required&&P.jsxs(go,{ownerState:f,"aria-hidden":!0,className:y.asterisk,children:[" ","*"]})]}))}),bo=yo;function wo(a){return ut("MuiInputLabel",a)}pt("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const xo=["disableAnimation","margin","shrink","variant","className"],Co=a=>{const{classes:o,formControl:e,size:i,shrink:t,disableAnimation:l,variant:u,required:c}=a,m={root:["root",e&&"formControl",!l&&"animated",t&&"shrink",i&&i!=="normal"&&`size${Ge(i)}`,u],asterisk:[c&&"asterisk"]},d=mt(m,wo,o);return ee({},o,d)},To=$e(bo,{shouldForwardProp:a=>Vi(a)||a==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(a,o)=>{const{ownerState:e}=a;return[{[`& .${lt.asterisk}`]:o.asterisk},o.root,e.formControl&&o.formControl,e.size==="small"&&o.sizeSmall,e.shrink&&o.shrink,!e.disableAnimation&&o.animated,e.focused&&o.focused,o[e.variant]]}})(({theme:a,ownerState:o})=>ee({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},o.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},o.size==="small"&&{transform:"translate(0, 17px) scale(1)"},o.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!o.disableAnimation&&{transition:a.transitions.create(["color","transform","max-width"],{duration:a.transitions.duration.shorter,easing:a.transitions.easing.easeOut})},o.variant==="filled"&&ee({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},o.size==="small"&&{transform:"translate(12px, 13px) scale(1)"},o.shrink&&ee({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},o.size==="small"&&{transform:"translate(12px, 4px) scale(0.75)"})),o.variant==="outlined"&&ee({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},o.size==="small"&&{transform:"translate(14px, 9px) scale(1)"},o.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))),Eo=X.forwardRef(function(o,e){const i=ft({name:"MuiInputLabel",props:o}),{disableAnimation:t=!1,shrink:l,className:u}=i,c=dt(i,xo),m=sn();let d=l;typeof d>"u"&&m&&(d=m.filled||m.focused||m.adornedStart);const f=ln({props:i,muiFormControl:m,states:["size","variant","required","focused"]}),y=ee({},i,{disableAnimation:t,formControl:m,shrink:d,size:f.size,variant:f.variant,required:f.required,focused:f.focused}),x=Co(y);return P.jsx(To,ee({"data-shrink":d,ownerState:y,ref:e,className:ht(x.root,u)},c,{classes:x}))}),Po=Eo;function Mo(a){return ut("MuiTextField",a)}pt("MuiTextField",["root"]);const So=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],ko={standard:Wi,filled:Ui,outlined:Hi},Ao=a=>{const{classes:o}=a;return mt({root:["root"]},Mo,o)},Oo=$e(io,{name:"MuiTextField",slot:"Root",overridesResolver:(a,o)=>o.root})({}),jo=X.forwardRef(function(o,e){const i=ft({props:o,name:"MuiTextField"}),{autoComplete:t,autoFocus:l=!1,children:u,className:c,color:m="primary",defaultValue:d,disabled:f=!1,error:y=!1,FormHelperTextProps:x,fullWidth:E=!1,helperText:M,id:S,InputLabelProps:O,inputProps:T,InputProps:g,inputRef:C,label:p,maxRows:w,minRows:k,multiline:te=!1,name:Z,onBlur:ne,onChange:re,onFocus:pe,placeholder:ve,required:Q=!1,rows:q,select:L=!1,SelectProps:j,type:F,value:_,variant:U="outlined"}=i,ae=dt(i,So),Y=ee({},i,{autoFocus:l,color:m,disabled:f,error:y,fullWidth:E,multiline:te,required:Q,select:L,variant:U}),B=Ao(Y),V={};U==="outlined"&&(O&&typeof O.shrink<"u"&&(V.notched=O.shrink),V.label=p),L&&((!j||!j.native)&&(V.id=void 0),V["aria-describedby"]=void 0);const R=qi(S),W=M&&R?`${R}-helper-text`:void 0,N=p&&R?`${R}-label`:void 0,oe=ko[U],H=P.jsx(oe,ee({"aria-describedby":W,autoComplete:t,autoFocus:l,defaultValue:d,fullWidth:E,multiline:te,name:Z,rows:q,maxRows:w,minRows:k,type:F,value:_,id:R,inputRef:C,onBlur:ne,onChange:re,onFocus:pe,placeholder:ve,inputProps:T},V,g));return P.jsxs(Oo,ee({className:ht(B.root,c),disabled:f,error:y,fullWidth:E,ref:e,required:Q,color:m,variant:U,ownerState:Y},ae,{children:[p!=null&&p!==""&&P.jsx(Po,ee({htmlFor:R,id:N},O,{children:p})),L?P.jsx(zi,ee({"aria-describedby":W,id:R,labelId:N,value:_,input:H},j,{children:u})):H,M&&P.jsx(uo,ee({id:W},x,{children:M}))]}))}),Fo=jo;function Nn(){return{width:window.innerWidth,height:window.innerHeight}}function Lo(){const[a,o]=X.useState(Nn);return X.useEffect(()=>{const e=()=>o(Nn());return window.addEventListener("resize",e,!1),()=>window.removeEventListener("resize",e,!1)}),a}const No={canSelect:!0},Io=[{id:"1FFE10C1-0D7C-43BC-9973-30B007413688",type:"Point",point:[-4.738885879516602,2.3911326683585354,.1066827454160853]},{id:"DD69DCA9-A82E-4C34-AF75-7645A3266020",type:"Polyline",points:[[-4.738885879516602,2.503221730034749,-.12623191596982744],[-4.738885879516602,2.4674714373394053,-.4447907572044876],[-4.738885879516602,2.2125513422068317,-.4012974617765653],[-4.738885879516602,2.2704365828326267,-.7289262696796821]]},{id:"F22713F0-6BF0-48F2-B6D9-66B92EB714DC",type:"Polygon",points:[[-4.123815036198345,16264862369528197e-31,.6749571893360409],[-4.136171940569206,.8818357559928545,.8036810838238246],[-4.3480243783849355,.724703895663797,.8701076327433946],[-4.322683971372346,-.012037871935272133,.7562943264963584],[-4.123815036198345,16264862369528197e-31,.6749571893360409]]},{id:"A942DC40-40D6-4A0F-8BC9-19E9DD850C08",type:"Prism",points:[[-2.4131620014070174,.018038999289274483,-1.207647024839197],[-2.4127824102240942,.018038999289274344,-.5716545369055135],[-3.520203358321013,.01803899928927434,-.5678070125921177],[-3.5131582779769177,.018038999289274493,-1.1851689610919873],[-2.4131620014070174,.018038999289274483,-1.207647024839197]],heightPoint:[-2.4131620014070174,.4707989006611939,-1.207647024839197]},{id:"9C5CEB5C-BCFB-4F9E-9D84-42CDF7281228",type:"Prism",points:[[-2.6470714095143593,-8041061834741193e-32,3.2584159064653644],[-2.637971623351746,50202511398003345e-33,2.6701866640142176],[-2.336549624421886,5266101539288679e-32,2.6591145463389716],[-2.341717352875142,4601707372000617e-33,2.8755544280335186],[-2.184587351257383,59497260386172046e-34,2.8694834916688556],[-2.1825869400001703,5445206699990355e-32,2.6510483669890097],[-1.8131780407727391,5843207797267285e-32,2.6331239910551156],[-1.8611367105760839,-7827090223273434e-32,3.2487794817686235],[-2.6470714095143593,-8041061834741193e-32,3.2584159064653644]],heightPoint:[-2.6470714095143593,1.32416914526614,3.2584159064653644],style:{color:16777215,lineWidth:2,lineColor:0}},{id:"CAF69586-3BB5-4A37-A7AA-FBC5C88E6996",type:"Rectangle",points:[[-2.4274088224018415,1.3539024371510313,.9610878547741487],[-2.428574817334936,.6853364421941678,.9600498679190829],[-3.575266107181009,.6873363937611323,.9599888117999944]]},{id:"D99B0AAD-25ED-4C3B-BFE0-64B6CC03996B",type:"Box",points:[[-2.1242848540750625,.018038999289272585,-.655001084591663],[-1.794807866790269,.018038999289272387,-.6414779785901621],[-1.7796361771696478,.01803899928927244,-1.0111210611532546],[-2.1091131644544414,.018038999289272637,-1.0246441671547555]],heightPoint:[-2.1242848540750625,.4707989006611939,-.655001084591663]},{id:"18B3E2C9-A819-4512-A027-736B4624D05A",type:"Circle",center:[-.9498732682996174,.049007514594023534,.710318705159093],normal:[0,1,2220446049250313e-31],radius:.18007321717337893},{id:"30177B49-83C2-4BEE-B495-445D0361D632",type:"Cylinder",bottomCenter:[-1.6185205671892007,-.5286661211819706,-2.0447939503537684],topCenter:[-1.6185205671892007,.4153925316850735,-2.0447939503537684],radius:.14389725187254376},{id:"406FBD37-94C1-4932-812A-32450C58ED71",type:"Circle",center:[-1.8498490828523424,.8382695041393857,-1.5572988483779244],normal:[-965602322046556e-30,.9999935922552198,-.0035798671066719565],radius:.42761549138935556}],_o={config:No,items:Io};var cn={},Ro=Ri;Object.defineProperty(cn,"__esModule",{value:!0});var Vn=cn.default=void 0,Do=Ro(Di()),Bo=P;Vn=cn.default=(0,Do.default)((0,Bo.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"}),"RestartAlt");const zo={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"80vw",bgcolor:"#fff",border:"2px solid #000",boxShadow:24,p:4};function Wo(a){var f,y;const o=rn(),[e,i]=X.useState(!1),[t,l]=X.useState((f=o.work)!=null&&f.raw.works[0]?JSON.stringify(JSON.parse((y=o.work)==null?void 0:y.raw.works[0]),null,2):""),u=()=>{var x,E;i(!0),l((x=o.work)!=null&&x.raw.works[0]?JSON.stringify(JSON.parse((E=o.work)==null?void 0:E.raw.works[0]),null,2):"")},c=()=>i(!1),m=()=>{localStorage.clear(),location.reload()},d=()=>{t&&(o.currentMode!=="Panorama"&&o.changeMode("Panorama"),o.ready().then(()=>{t&&o.load(t).then(()=>{a!=null&&a.onChangeWork&&a.onChangeWork(),localStorage.clear(),localStorage.setItem(`dnawork-${location.pathname}`,t),c()}).catch(x=>{console.error(x),localStorage.clear(),location.reload()})}))};return P.jsxs(P.Fragment,{children:[P.jsx(tn,{sx:{position:"fixed",bottom:0,right:0},children:P.jsxs(at,{variant:"contained",children:[P.jsx($,{onClick:u,children:"自定义work"}),P.jsxs($,{onClick:m,children:[P.jsx(Vn,{}),"重置"]})]})}),P.jsx(Yi,{open:e,onClose:c,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:P.jsxs(st,{sx:zo,children:[P.jsx(Fo,{id:"filled-multiline-static",label:"Work",sx:{width:"100%",height:"100%"},multiline:!0,onChange:x=>l(x.target.value),value:t,rows:20,variant:"filled"}),P.jsx($,{sx:{marginTop:"30px",marginRight:"10px"},variant:"outlined",onClick:c,children:"取消"}),P.jsx($,{sx:{marginTop:"30px"},variant:"contained",onClick:d,children:"应用"})]})})]})}const Uo={occlusionVisibility:!0,occlusionMode:"translucence",lengthEnable:!0};let Be={};function Ho(a,o,e){const i=a.parent;if(!i)return;const t=(e==null?void 0:e.limit)??"none",l=new Ve(a.style);i.add(l);const u=new Ve({...a.style,dashed:!0,lengthEnable:!1});i.add(u),o.enable();const c=a.points.map(M=>M.clone());let m,d;const f=M=>{if(!M)return;const S=c.length===0?M.point:m.clone();c.push(S),a.setPoints(c),c.length===2&&x()},y=M=>{const S=()=>{l.setPoints([]),u.setPoints([]),o.pointSelectorHelper.magnifier.render()};if(!(c!=null&&c.length)||!M)return S();const O=c[c.length-1].clone();t==="none"?(m=M.point,l.setPoints([O,m])):t==="xoz"?(o.plane=d,d=d??new di().setFromNormalAndCoplanarPoint(new z(0,1,0),c[0]),m=d.projectPoint(M.point,new z),l.setPoints([O,m]),u.setPoints([m,M.point])):t==="y"&&(M.isVirtual?(m=Yn({raycaster:M.raycaster,line:new Jt(c[0].clone(),new z(0,1,0).add(c[0])),clampToLine:!1}),u.setPoints([])):(m=new Jt(c[0].clone(),new z(0,1,0).add(c[0])).closestPointToPoint(M.point,!1,new z),u.setPoints([m,M.point])),l.setPoints([O,m]))},x=()=>{o.off("select",f),o.off("intersectionUpdate",y),o.off("disable",E),o.plane=null,o.disable(),i==null||i.remove(l,u)},E=()=>{x(),c.length!==2&&(i==null||i.remove(a))};o.on("select",f),o.on("intersectionUpdate",y),o.on("disable",E)}const Yo=a=>{const o=At.modules.pointSelector,e=a.scene.getObjectByName("yuanzhangdemo")??(()=>{const y=new Nt;return y.name="yuanzhangdemo",a.scene.add(y),y})(),i={...Uo,color:6795114,lineColor:11135708,lineWidth:2},t=new An({...i,points:new z(0,0,0),color:16777215});t.visible=!1,e.add(t);const l=new Ve(i);e.add(l);const u=new Ve({...i,dashed:!1,lengthEnable:!0});e.add(u),o.enable();const c=y=>{if(y)if(Be.start){Be={};const x=u.points[0].clone().sub(a.camera.position).normalize().multiplyScalar(100);e.add(new Ve({points:[u.points[0].clone().sub(x),u.points[0].clone().add(x)],...i,lengthEnable:!1})),o.disable(),Ho(u,o,{limit:"y"})}else{const x=y.point.clone(),E=x.clone().sub(a.camera.position).normalize().multiplyScalar(100),M=new An({points:x,...i,color:16711680});M.position.set(x.x,x.y,x.z),e.add(M),e.add(new Ve({points:[x.clone().sub(E),x.clone().add(E)],...i,lengthEnable:!1})),o.disable(),Be.start=a.camera.position.clone(),Be.end=x.clone()}},m=y=>{const x=()=>{l.setPoints([]),u.setPoints([])};if(!y)return x();if(Be.start){const E=new Jt(Be.start,Be.end),M=Yn({raycaster:y.raycaster,line:E,clampToLine:!1});t.position.copy(M),t.visible=!0,u.setPoints([M])}},d=()=>{o.off("select",c),o.off("intersectionUpdate",m),o.off("disable",f),o.plane=null,o.disable()},f=()=>{d()};o.on("select",c),o.on("intersectionUpdate",m),o.on("disable",f)},Vo=a=>{const o=a.scene.getObjectByName("yuanzhangdemo");o&&(o.children.forEach(e=>{e.dispatchEvent({type:"removed"})}),a.scene.remove(o))},fe={occlusionVisibility:!0,occlusionMode:"translucence",lengthEnable:!1},Xo=()=>{const a=rn(),o=a.plugins.Sculpt,[e,i]=X.useState("virtualPoint"),[t,l]=X.useState("none"),[u,c]=X.useState(!0),[m,d]=X.useState(2.5),[f,y]=X.useState(200),[x,E]=X.useState(!1),M=g=>{At.modules.pointSelector.actionIfNoIntersection=g,i(g)},S=g=>{fe.limit=g,l(g)},O=()=>{const g=At.modules.pointSelector;if(g&&g.pointSelectorHelper){const C=g.pointSelectorHelper.magnifier;if(g.pointSelectorHelper,C)if(u){C.enable();const p=C.canvas;p&&(p.style.display="block",p.style.visibility="visible"),"updateScale"in C&&typeof C.updateScale=="function"&&C.updateScale(m),"updateSize"in C&&typeof C.updateSize=="function"&&C.updateSize(f)}else{C.clear(),C.disable();const p=C.canvas;if(p){p.style.visibility="hidden",p.style.display="none";const w=p.getContext("2d");w&&w.clearRect(0,0,p.width,p.height),p.parentNode&&p.parentNode.removeChild(p)}}}},T=()=>{const g=At.modules.pointSelector;if(g&&g.pointSelectorHelper){const p=g.pointSelectorHelper.pointHelper;if(p){if(x){if(p.visible=!1,p.children&&p.children.forEach(w=>{w.visible=!1}),"planeMesh"in p){const w=p;w.planeMesh&&(w.planeMesh.visible=!1),w.lineMesh&&(w.lineMesh.visible=!1),w.ballMesh&&(w.ballMesh.visible=!1),w.borderMesh&&(w.borderMesh.visible=!1)}if("ringMesh"in p){const w=p;w.planeMesh&&(w.planeMesh.visible=!1),w.ringMesh&&(w.ringMesh.visible=!1),w.lineMesh&&(w.lineMesh.visible=!1),w.ballMesh&&(w.ballMesh.visible=!1),w.cssBallMesh&&(w.cssBallMesh.visible=!1),w.crossline&&(w.crossline.visible=!1)}}else{if(p.visible=!0,p.children&&p.children.forEach(w=>{w.visible=!0}),"planeMesh"in p){const w=p;w.planeMesh&&(w.planeMesh.visible=!0),w.lineMesh&&(w.lineMesh.visible=!0),w.ballMesh&&(w.ballMesh.visible=!0),w.borderMesh&&(w.borderMesh.visible=!0)}if("ringMesh"in p){const w=p;w.planeMesh&&(w.planeMesh.visible=!0),w.ringMesh&&(w.ringMesh.visible=!0),w.lineMesh&&(w.lineMesh.visible=!0),w.ballMesh&&(w.ballMesh.visible=!0),w.cssBallMesh&&(w.cssBallMesh.visible=!0),w.crossline&&(w.crossline.visible=!0)}}a.needsRender=!0}}};return X.useEffect(()=>{O()},[u,m,f]),X.useEffect(()=>{T()},[x]),X.useEffect(()=>{if(!a.getElement())return;const g=[],C=document.createElement("div");if(C.style.cssText="position: absolute; top: 90px; right: 24px; width: 160px; height: 160px;",a.plugins.OrientationPlugin){const p=()=>{a.plugins.OrientationPlugin.enable(),a.getElement().parentElement.appendChild(C),a.plugins.OrientationPlugin.appendTo(C)};Ni.waitFiveModelLoaded(a).then(()=>{p()}),g.push(()=>{C.parentNode&&C.parentNode.removeChild(C),a.plugins.OrientationPlugin.dispose()})}return()=>{g.forEach(p=>p())}},[]),X.useEffect(()=>{var g;return(g=a.work)!=null&&g.workCode||(o.load(_o,{occlusionVisibility:!0,defaultAction:!1}),o.on("click",(C,p)=>(p.select({only:!0}),p.editor.enable(),p.editor.hooks.on("objectUpdate",()=>{console.info("new Data: ",p.data)}),!1))),()=>{o.clear()}},[a]),P.jsxs(P.Fragment,{children:[P.jsx(_i,{modeList:["Mapview","Panorama","Model"]}),P.jsx(tn,{sx:{position:"fixed",bottom:0,right:230},children:P.jsx($,{onClick:()=>{a.setState({mode:"Mapview",offset:a.camera.position.clone(),fov:a.state.fov,distance:0,latitude:a.state.latitude,longitude:a.state.longitude})},children:"Mapview 当前视角"})}),P.jsx(Wo,{onChangeWork:()=>o.clear()}),P.jsxs(tn,{sx:{position:"fixed",top:20,right:20,p:2,width:280},children:[P.jsx(nt,{variant:"h6",gutterBottom:!0,children:"光标和放大镜配置"}),P.jsxs(st,{sx:{mb:2},children:[P.jsx(nt,{variant:"body2",children:"隐藏光标圆圈效果"}),P.jsx(qt,{checked:x,onChange:g=>E(g.target.checked)})]}),P.jsxs(st,{sx:{mb:2},children:[P.jsx(nt,{variant:"body2",children:"启用放大镜"}),P.jsx(qt,{checked:u,onChange:g=>c(g.target.checked)})]}),P.jsxs(st,{sx:{mb:2},children:[P.jsxs(nt,{variant:"body2",children:["放大倍数: ",m,"x"]}),P.jsx(On,{value:m,onChange:(g,C)=>d(C),min:1,max:5,step:.1,disabled:!u})]}),P.jsxs(st,{sx:{mb:2},children:[P.jsxs(nt,{variant:"body2",children:["放大镜大小: ",f,"px"]}),P.jsx(On,{value:f,onChange:(g,C)=>y(C),min:100,max:400,step:10,disabled:!u})]})]}),P.jsxs(jn,{sx:{position:"absolute",right:0,display:"flex",alignItems:"end"},spacing:1,children:[P.jsx(at,{sx:{width:"max-content"},orientation:"vertical",color:"inherit",variant:"contained",children:P.jsxs($,{color:"primary",variant:"contained",children:["长度显示",P.jsx(qt,{defaultChecked:!1,onChange:g=>{o.items.forEach(C=>{var p;C.type!=="Circle"&&C.type!=="Cylinder"&&((p=C.children)==null?void 0:p[0]).setStyle({lengthEnable:g.target.checked})}),fe.lengthEnable=g.target.checked}})]})}),P.jsxs(at,{sx:{width:"max-content"},color:"inherit",variant:"contained",children:[P.jsx($,{color:e==="virtualPoint"?"primary":void 0,onClick:()=>M("virtualPoint"),children:"虚拟点"}),P.jsx($,{color:e==="lastPoint"?"primary":void 0,onClick:()=>M("lastPoint"),children:"最新可用点"}),P.jsx($,{color:e==="disable"?"primary":void 0,onClick:()=>M("disable"),children:"禁用"})]})]}),P.jsxs(jn,{spacing:1,children:[P.jsxs(at,{sx:{width:"max-content"},color:"inherit",variant:"contained",children:[P.jsx($,{color:t==="none"?"primary":void 0,onClick:()=>S("none"),children:"自由"}),P.jsx($,{color:t==="xoz"?"primary":void 0,onClick:()=>S("xoz"),children:"水平"}),P.jsx($,{color:t==="y"?"primary":void 0,onClick:()=>S("y"),children:"垂直"})]}),P.jsxs(at,{sx:{width:"max-content"},orientation:"vertical",color:"inherit",variant:"contained",children:[P.jsx($,{onClick:()=>Yo(a),children:"双目"}),P.jsx($,{onClick:()=>o.createPoint({...fe}),children:"点(Point)"}),P.jsx($,{onClick:()=>o.createLine({...fe}),children:"线段(Line)"}),P.jsx($,{onClick:()=>o.createPolyline({...fe}),children:"折线(PolyLine)"}),P.jsx($,{onClick:()=>o.createPolygon({...fe}),children:"多边形(Polygon)"}),P.jsx($,{onClick:()=>o.createRectangle({...fe,drawMethod:"vertex"}),children:"矩形(Rectangle)"}),P.jsx($,{onClick:()=>o.createRectangle({...fe,drawMethod:"diagonal"}),children:"矩形【对角线】"}),P.jsx($,{onClick:()=>o.createBox({...fe,drawMethod:"vertex"}),children:"长方体(Box)"}),P.jsx($,{onClick:()=>o.createBox({...fe,drawMethod:"diagonal"}),children:"长方体【对角线】"}),P.jsx($,{onClick:()=>o.createPrism({...fe}),children:"多棱柱(Prism)"}),P.jsx($,{onClick:()=>o.createCircle({...fe}),children:"圆(Circle)"}),P.jsx($,{onClick:()=>o.createCylinder({...fe}),children:"圆柱体(Cylinder)"}),P.jsx($,{color:"error",variant:"outlined",onClick:()=>{o.clear(),Vo(a)},children:"清空"})]})]})]})};function qo(a){return/^https?:\/\/|^\/\//.test(a)||/^data:/.test(a)}function Go(a,o){return qo(o)?o:"".concat(a).concat(o)}var ze;(function(a){var o=function(){function e(i,t){this.hooks=new fi,this.staticPrefix="//vr-image-4.realsee-cdn.cn",this.five=i,t!=null&&t.staticPrefix&&(this.staticPrefix=t.staticPrefix)}return e.prototype.getCurrentState=function(){return this.state},e.prototype.absoluteUrl=function(i){return Go(this.staticPrefix,i)},e}();a.Controller=o})(ze||(ze={}));var nn=function(a,o){return nn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])},nn(a,o)};function Ke(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");nn(a,o);function e(){this.constructor=a}a.prototype=o===null?Object.create(o):(e.prototype=o.prototype,new e)}var K=function(){return K=Object.assign||function(a){for(var o,e=1,i=arguments.length;e<i;e++){o=arguments[e];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(a[t]=o[t])}return a},K.apply(this,arguments)};function Xe(a,o,e,i){function t(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function c(f){try{d(i.next(f))}catch(y){u(y)}}function m(f){try{d(i.throw(f))}catch(y){u(y)}}function d(f){f.done?l(f.value):t(f.value).then(c,m)}d((i=i.apply(a,o||[])).next())})}function qe(a,o){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,t,l,u=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return u.next=c(0),u.throw=c(1),u.return=c(2),typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(d){return function(f){return m([d,f])}}function m(d){if(i)throw new TypeError("Generator is already executing.");for(;u&&(u=0,d[0]&&(e=0)),e;)try{if(i=1,t&&(l=d[0]&2?t.return:d[0]?t.throw||((l=t.return)&&l.call(t),0):t.next)&&!(l=l.call(t,d[1])).done)return l;switch(t=0,l&&(d=[d[0]&2,l.value]),d[0]){case 0:case 1:l=d;break;case 4:return e.label++,{value:d[1],done:!1};case 5:e.label++,t=d[1],d=[0];continue;case 7:d=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(d[0]===6||d[0]===2)){e=0;continue}if(d[0]===3&&(!l||d[1]>l[0]&&d[1]<l[3])){e.label=d[1];break}if(d[0]===6&&e.label<l[1]){e.label=l[1],l=d;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(d);break}l[2]&&e.ops.pop(),e.trys.pop();continue}d=o.call(a,e)}catch(f){d=[6,f],t=0}finally{i=l=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function In(a,o,e){if(e||arguments.length===2)for(var i=0,t=o.length,l;i<t;i++)(l||!(i in o))&&(l||(l=Array.prototype.slice.call(o,0,i)),l[i]=o[i]);return a.concat(l||Array.prototype.slice.call(o))}function $o(a){return new Promise(function(o,e){var i=new Image;i.onload=function(){i.onload=i.onerror=function(){},o(i)},i.onerror=function(t){i.onload=i.onerror=function(){},e(t)},i.crossOrigin="",i.src=a})}var Ko=typeof performance<"u"&&typeof performance.timing<"u"?performance.timing.navigationStart:Date.now(),Gt=typeof performance<"u"?function(){return Ko+performance.now()}:function(){return Date.now()};function Ot(a,o,e){return a+(o-a)*e}function Zo(a,o,e,i){var t=(o*e+2*a)/Math.pow(e,3),l=-(2*o*e+3*a)/Math.pow(e,2),u=o,c=a;return t*Math.pow(i,3)+l*Math.pow(i,2)+u*i+c}function Qo(a,o,e,i){var t=(o*e+2*a)/Math.pow(e,3),l=-(2*o*e+3*a)/Math.pow(e,2),u=o;return 3*t*Math.pow(i,2)+2*l*i+u}function Jo(a,o,e,i){var t=i[1]-i[0];return a=Ft(a,i),o=Ft(o,i),o-a>t/2?Ot(a+t,o,e):a-o>t/2?Ot(a-t,o,e):Ot(a,o,e)}function Ft(a,o){var e=o[1]-o[0];return a<o[0]?Ft(a+e,o):a>=o[1]?Ft(a-e,o):a}function er(a,o,e,i){return i?Jo(a,o,e,i):Ot(a,o,e)}var _n=function(){function a(o){this.config={},this.progress=1,this.ended=!0,this.value={},this.startTime=Gt(),this.startVelocity=0,this.duration=0,this.keyframes=[];for(var e in o){var i=o[e];typeof i=="number"?(this.value[e]=i,this.config[e]={circle:!1}):(this.value[e]=i.value,this.config[e]={circle:i.circle})}this.keyframes=[{progress:0,value:K({},this.value)},{progress:1,value:K({},this.value)}]}return a.prototype.getProgress=function(o){var e=o-this.startTime;return e<0?0:e>=this.duration?1:1-Zo(1,this.startVelocity,this.duration,e)},a.prototype.getValue=function(o){for(var e=1;e<this.keyframes.length;e++)if(this.keyframes[e].progress>o){var i=this.keyframes[e-1],t=this.keyframes[e],l={};for(var u in this.config){var c=(o-i.progress)/(t.progress-i.progress);l[u]=er(i.value[u],t.value[u],c,this.config[u].circle)}return l}return K({},this.keyframes[this.keyframes.length-1].value)},a.prototype.getProgressVelocity=function(o){var e=o-this.startTime;return e>=this.duration?0:Qo(1,this.startVelocity,this.duration,e)},a.prototype.update=function(o){return this.ended?!0:(this.progress=Math.min(1,Math.max(0,this.progress,this.getProgress(o))),this.value=this.getValue(this.progress),this.ended=this.progress>=1,this.ended&&this.callbacks&&(this.callbacks[0](),this.callbacks=void 0),this.ended)},a.prototype.getKeyFrameSegment=function(o){for(var e=this.getProgress(o),i=1;i<this.keyframes.length;i++)if(this.keyframes[i].progress>e)return[this.keyframes[i-1],this.keyframes[i]];return[this.keyframes[this.keyframes.length-2],this.keyframes[this.keyframes.length-1]]},a.prototype.getTargetKeyframe=function(){return this.keyframes[this.keyframes.length-1]},a.prototype.set=function(o,e,i,t){var l;i===void 0&&(i=0),isNaN(e)&&(e=0),isNaN(i)&&(i=0),t=t??Gt();var u=this.getProgress(t),c=this.getValue(u),m={};for(var d in this.config)m[d]=(l=o[d])!==null&&l!==void 0?l:c[d];var f=[{progress:0,value:c},{progress:1,value:m}];return this.setKeyframes(f,e,i,t)},a.prototype.setKeyframes=function(o,e,i,t){var l=this;if(i===void 0&&(i=0),o.length<2)throw new Error("keyframes invalid.");return isNaN(e)&&(e=0),isNaN(i)&&(i=0),this.callbacks&&(this.callbacks[1](new Error("motion aborted.")),this.callbacks=void 0),new Promise(function(u,c){t=t??Gt(),l.progress=0,l.ended=!1,l.startTime=t,l.startVelocity=i,l.keyframes=o,l.duration=e,e===0?(l.progress=1,l.value=K({},o[o.length-1].value)):l.value=K({},o[0].value),l.callbacks=[u,c]})},a.prototype.dispose=function(){this.callbacks&&(this.callbacks[1](new Error("motion dispose.")),this.callbacks=void 0)},a}(),tr=[{progress:0,value:{scale:0,opacity:0,shadow:2}},{progress:.2,value:{scale:.5,opacity:1,shadow:1}},{progress:.8,value:{scale:2,opacity:0,shadow:.5}},{progress:1,value:{scale:2,opacity:0,shadow:.5}}],nr=[{progress:0,value:{scale:0,opacity:0,shadow:2}},{progress:.2,value:{scale:.4,opacity:1,shadow:2}},{progress:.8,value:{scale:1.6,opacity:.4,shadow:.5}},{progress:1,value:{scale:2,opacity:0,shadow:.5}}],ir=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,or=`
varying vec2 vUv;
uniform sampler2D map;
uniform vec4 color;

float colorGap(vec3 color1, vec3 color2) {
  float gap = abs(color1.r - color2.r) + abs(color1.g - color2.g) + abs(color1.b - color2.b);
  return gap;
}

void main() {
  vec3 u_outlineColor = vec3(1.0, 0.0, 0.0);
  vec4 image = texture2D(map, vUv);
  vec2 invSize = 1.0 / vec2(2048, 1024);
  if (colorGap(image.rgb, color.rgb) < 0.05 && colorGap(color.rgb, vec3(0.0, 0.0, 0.0)) > 0.1) {
    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
  }
  else {
    vec2 offsetX = vec2(1.0, 0.0);
    vec2 offsetY = vec2(0.0, 1.0);
    vec2 offsetXY = vec2(1.0, 1.0);
    vec2 offsetYX = vec2(-1.0, 1.0);
    float count = 0.0;
    for (float i = -4.0; i <= 4.0; i++) {
      vec4 c1 = texture2D(map, vUv + i * invSize * offsetX / 4.0);
      vec4 c2 = texture2D(map, vUv + i * invSize * offsetY / 4.0);
      vec4 c3 = texture2D(map, vUv + i * invSize * offsetXY / 4.0);
      vec4 c4 = texture2D(map, vUv + i * invSize * offsetYX / 4.0);
      if (colorGap(c1.rgb, color.rgb) < 0.05 && colorGap(c1.rgb, vec3(0.0, 0.0, 0.0)) > 0.1) {
        count++;
      }
      if (colorGap(c2.rgb, color.rgb) < 0.05 && colorGap(c2.rgb, vec3(0.0, 0.0, 0.0)) > 0.1) {
        count++;
      }
      if (colorGap(c3.rgb, color.rgb) < 0.05 && colorGap(c3.rgb, vec3(0.0, 0.0, 0.0)) > 0.1) {
        count++;
      }
      if (colorGap(c4.rgb, color.rgb) < 0.05 && colorGap(c4.rgb, vec3(0.0, 0.0, 0.0)) > 0.1) {
        count++;
      }
    }
    if (count > 0.0) {
      gl_FragColor = vec4(1.0, 1.0, 1.0, mix(0.0, 1.0, count / (4.0 * 8.0 + 1.0)));
    }
  }
}
`;(function(a){Ke(o,a);function o(e,i){var t=a.call(this,e)||this;t.canvas=document.createElement("canvas"),t.group=new Nt,t.wrapper=document.createElement("div"),t.style=document.createElement("style"),t.itemMaskMesh=function(){var c=new be(new mi(1,60,40),new jt({vertexShader:ir,fragmentShader:or,uniforms:{map:{value:new Hn},color:{value:new Mt}},depthWrite:!1,depthTest:!1,transparent:!0}));return c.renderOrder=-3,c.geometry.rotateY(-Math.PI/2),c.geometry.scale(-1,1,1),c}(),t.onFivePanoArrived=function(c){t.state.mode==="mask"&&t.loadPanoMask(c)},t.onFiveWantsMoveToPano=function(c){t.state.mode==="box"&&t.select()},t.loadPanoMask=function(c){return Xe(t,void 0,void 0,function(){var m,d,f,y,x,E,M,S,O,T;return qe(this,function(g){switch(g.label){case 0:return m=this,d=m.five,f=m.canvas,y=m.itemMaskMesh,x=m.data,E=f.getContext("2d"),M=d.observers[c],S=(T=x==null?void 0:x.object_mask_list.find(function(C){return C.derived_id===String(M.derivedId)}))===null||T===void 0?void 0:T.object_mask_url,S?[4,$o(S)]:[2];case 1:return O=g.sent(),f.width=O.width,f.height=O.height,E==null||E.drawImage(O,0,0,O.width,O.height),y.material.uniforms.map.value.image=O,y.material.uniforms.map.value.minFilter=Si,y.material.uniforms.map.value.needsUpdate=!0,y.position.copy(M.position),y.quaternion.copy(M.quaternion),d.scene.add(y),d.needsRender=!0,[2]}})})},t.onFiveMouseMove=function(c){var m;if(t.state.mode==="mask"&&t.five.state.mode==="Panorama"){var d=t,f=d.five,y=d.itemMaskMesh,x=f.observers[f.state.panoIndex],E=(m=c.pointers[0])===null||m===void 0?void 0:m.raycaster;if(E){var M=E.intersectObjects(t.group.children.filter(function(S){return S.userData.visible_viewpoint.includes(String(x.derivedId))}),!0)[0];M?y.material.uniforms.color.value=M.object.userData.color:y.material.uniforms.color.value=new Mt(0,0,0,1)}}},t.onFiveTapGesture=function(c){var m=t.five,d=m.observers[m.state.panoIndex];if(c){var f=c.intersectObjects(t.group.children.filter(function(E){return E.userData.visible_viewpoint.includes(String(d.derivedId))}),!0)[0];if(f){t.select(f.object.name),t.stopAnimation&&t.stopAnimation(),t.tapPosition=f.point,t.changeTapScreenPosition();var y=new _n({opacity:0,scale:0,shadow:2}),x=new _n({opacity:0,scale:0,shadow:2});return y.setKeyframes(tr,1e3),x.setKeyframes(nr,1e3),t.stopAnimation=an.shared.add(function(E,M){var S,O=y.update(E),T=x.update(E);t.wrapper.firstChild.style.opacity="".concat(y.value.opacity),t.wrapper.firstChild.style.transform="scale(".concat(y.value.scale,")"),t.wrapper.firstChild.style.boxShadow="0 0 0 ".concat(y.value.shadow,"px #fff"),t.wrapper.lastChild.style.opacity="".concat(x.value.opacity),t.wrapper.lastChild.style.transform="scale(".concat(x.value.scale,")"),t.wrapper.lastChild.style.boxShadow="0 0 0 ".concat(x.value.shadow,"px #fff"),O&&T&&((S=t.stopAnimation)===null||S===void 0||S.call(t),t.stopAnimation=void 0,m.getElement().parentElement.removeChild(t.wrapper))},!1,0,10),m.getElement().parentElement.appendChild(t.wrapper),!1}}},t.changeTapScreenPosition=function(){if(t.tapPosition){var c=t.tapPosition.clone().project(t.five.camera),m=(c.x+1)/2,d=-(c.y-1)/2;t.wrapper.style.opacity=c.z>0&&c.z<1?"1":"0",t.wrapper.style.transform="translate(".concat(m*100,"%, ").concat(d*100,"%)")}},t.onFiveCameraUpdate=function(c){t.changeTapScreenPosition()},t.dispose=function(){t.disable()},t.five=e;var l={enabled:!0,visible:!0,mode:"box",selectedId:null,selectAll:!1};t.state=Object.assign(l,i==null?void 0:i.initialState);var u=K({},i==null?void 0:i.config);return t._config=u,t.group.rotateX(Math.PI),t.wrapper.className="ItemMaskPlugin",t.wrapper.innerHTML='<span class="ItemMaskPluginCircle"></span><span class="ItemMaskPluginCircle"></span>',t.style.innerHTML=`
      .ItemMaskPlugin {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        pointer-events: none;
      }
      .ItemMaskPluginCircle {
        position: absolute;
        top: -10px;
        left: -10px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        box-shadow: 0px 0px 0px 2px #fff;
      }
    `,t.state.enabled&&t._enable({userAction:!1}),t}return Object.defineProperty(o.prototype,"config",{get:function(){return K({},this._config)},enumerable:!1,configurable:!0}),o.prototype.updateState=function(e,i){var t=this.state;this.state=K(K({},this.state),e),this.hooks.emit("stateChange",{state:this.state,prevState:t,userAction:i})},o.prototype.load=function(e){return Xe(this,void 0,void 0,function(){var i,t,l=this;return qe(this,function(u){return this.data=e,i=e.data_list.map(function(c){var m,d=c.position.end.map(function(w){return Number(w)}),f=c.position.start.map(function(w){return Number(w)}),y=Math.abs(d[0]-f[0]),x=Math.abs(d[1]-f[1]),E=Math.abs(d[2]-f[2]),M=d[0]/2+f[0]/2,S=d[1]/2+f[1]/2,O=d[2]/2+f[2]/2,T=new z(M,S,O),g=new ki(y,x,E),C=new jt({vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          uniform sampler2D map;
          uniform float opacity;
          varying vec2 vUv;

          void main() {
            float alpha = 0.15;
            float depth = 0.003;
            if (vUv.x < depth || vUv.x > 1.0 - depth) {
              alpha = mix(1.0, 0.25, abs(vUv.y - 0.5) * 2.0);
            } else if (vUv.y < depth || vUv.y > 1.0 - depth) {
              alpha = mix(1.0, 0.25, abs(vUv.x - 0.5) * 2.0);
            }
            if (gl_FrontFacing) {
              gl_FragColor = vec4(1.0, 1.0, 1.0, alpha * opacity);
            } else {
              gl_FragColor = vec4(1.0, 1.0, 1.0, alpha / 4.0 * opacity);
            }
          }
        `,side:Ai,visible:l.state.selectedId==="".concat(c.category_name).concat(c.index),uniforms:{opacity:{value:l.state.mode==="box"?1:0}},depthWrite:!1,depthTest:!1,transparent:!0}),p=new be(g,C);return p.position.copy(T),p.name="".concat(c.category_name).concat(c.index),p.userData.color=new((m=Mt).bind.apply(m,In(In([void 0],c.mask_color.map(function(w){return w/255}).reverse(),!1),[1],!1))),p.userData.visible_viewpoint=Object.keys(c.visible_viewpoint),p}),(t=this.group).add.apply(t,i),[2]})})},o.prototype.setState=function(e,i){i===void 0&&(i={});var t=this.state,l=i.userAction!==void 0?i.userAction:!0;if(this.updateState(e,l),e.enabled!==void 0&&t.enabled!==e.enabled){var u={userAction:l};e.enabled?this._enable(u):this._disable(u)}},o.prototype.setMode=function(e){this.updateState({mode:e},!1),e==="mask"?(this.group.children.forEach(function(i){i.material.uniforms.opacity.value=0}),this.loadPanoMask(this.five.state.panoIndex)):e==="box"&&(this.itemMaskMesh.material.uniforms.color.value=new Mt(0,0,0,1),this.group.children.forEach(function(i){i.material.uniforms.opacity.value=1}),this.five.needsRender=!0)},o.prototype.select=function(e,i){var t=this,l;this.updateState({selectedId:e??null},(l=i==null?void 0:i.userAction)!==null&&l!==void 0?l:!1),this.group.children.forEach(function(u){u.material.visible=t.state.selectAll||u.name===e}),this.five.needsRender=!0},o.prototype.selectAll=function(e){e===void 0&&(e=!0),this.updateState({selectAll:!!e},!1),this.select()},o.prototype._enable=function(e){this.five.on("panoArrived",this.onFivePanoArrived),this.five.on("wantsMoveToPano",this.onFiveWantsMoveToPano),this.five.on("gesture.mousemove",this.onFiveMouseMove),this.five.on("wantsTapGesture",this.onFiveTapGesture),this.five.on("cameraUpdate",this.onFiveCameraUpdate),this.five.scene.add(this.group),document.head.appendChild(this.style)},o.prototype._disable=function(e){this.five.off("panoArrived",this.onFivePanoArrived),this.five.off("wantsMoveToPano",this.onFiveWantsMoveToPano),this.five.off("gesture.mousemove",this.onFiveMouseMove),this.five.off("wantsTapGesture",this.onFiveTapGesture),this.five.off("cameraUpdate",this.onFiveCameraUpdate),this.five.scene.remove(this.group),document.head.removeChild(this.style)},o.prototype.enable=function(e){var i;if(!this.state.enabled){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!0},t),this._enable({userAction:t})}},o.prototype.disable=function(e){var i;if(this.state.enabled!==!1){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!1},t),this._disable({userAction:t})}},o})(ze.Controller);/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var $t=function(a,o,e,i){var t=["","webkit","Moz","MS","ms","o"],l=o.createElement?o.createElement("div"):i,u="function",c=Math.round,m=Math.abs,d=Date.now;function f(n,r,s){return setTimeout(g(n,s),r)}function y(n,r,s){return Array.isArray(n)?(x(n,s[r],s),!0):!1}function x(n,r,s){var v;if(n)if(n.forEach)n.forEach(r,s);else if(n.length!==i)for(v=0;v<n.length;)r.call(s,n[v],v,n),v++;else for(v in n)n.hasOwnProperty(v)&&r.call(s,n[v],v,n)}function E(n,r,s){var v="DEPRECATED METHOD: "+r+`
`+s+` AT 
`;return function(){var b=new Error("get-stack-trace"),A=b&&b.stack?b.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",D=a.console&&(a.console.warn||a.console.log);return D&&D.call(a.console,v,A),n.apply(this,arguments)}}var M;typeof Object.assign!="function"?M=function(n){if(n===i||n===null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(n),s=1;s<arguments.length;s++){var v=arguments[s];if(v!==i&&v!==null)for(var b in v)v.hasOwnProperty(b)&&(r[b]=v[b])}return r}:M=Object.assign;var S=E(function(n,r,s){for(var v=Object.keys(r),b=0;b<v.length;)(!s||s&&n[v[b]]===i)&&(n[v[b]]=r[v[b]]),b++;return n},"extend","Use `assign`."),O=E(function(n,r){return S(n,r,!0)},"merge","Use `assign`.");function T(n,r,s){var v=r.prototype,b;b=n.prototype=Object.create(v),b.constructor=n,b._super=v,s&&M(b,s)}function g(n,r){return function(){return n.apply(r,arguments)}}function C(n,r){return typeof n==u?n.apply(r&&r[0]||i,r):n}function p(n,r){return n===i?r:n}function w(n,r,s){x(ne(r),function(v){n.addEventListener(v,s,!1)})}function k(n,r,s){x(ne(r),function(v){n.removeEventListener(v,s,!1)})}function te(n,r){for(;n;){if(n==r)return!0;n=n.parentNode}return!1}function Z(n,r){return n.indexOf(r)>-1}function ne(n){return n.trim().split(/\s+/g)}function re(n,r,s){if(n.indexOf&&!s)return n.indexOf(r);for(var v=0;v<n.length;){if(s&&n[v][s]==r||!s&&n[v]===r)return v;v++}return-1}function pe(n){return Array.prototype.slice.call(n,0)}function ve(n,r,s){for(var v=[],b=[],A=0;A<n.length;){var D=n[A][r];re(b,D)<0&&v.push(n[A]),b[A]=D,A++}return v=v.sort(function(ie,se){return ie[r]>se[r]}),v}function Q(n,r){for(var s,v,b=r[0].toUpperCase()+r.slice(1),A=0;A<t.length;){if(s=t[A],v=s?s+b:r,v in n)return v;A++}return i}var q=1;function L(){return q++}function j(n){var r=n.ownerDocument||n;return r.defaultView||r.parentWindow||a}var F=/mobile|tablet|ip(ad|hone|od)|android/i,_="ontouchstart"in a,U=Q(a,"PointerEvent")!==i,ae=_&&F.test(navigator.userAgent),Y="touch",B="pen",V="mouse",R="kinect",W=25,N=1,oe=2,H=4,J=8,Le=1,Se=2,Ne=4,Ie=8,ke=16,de=Se|Ne,ge=Ie|ke,Ze=de|ge,Qe=["x","y"],_e=["clientX","clientY"];function ue(n,r){var s=this;this.manager=n,this.callback=r,this.element=n.element,this.target=n.options.inputTarget,this.domHandler=function(v){C(n.options.enable,[n])&&s.handler(v)},this.init()}ue.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(j(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(j(this.element),this.evWin,this.domHandler)}};function vt(n){var r,s=n.options.inputClass;return s?r=s:U?r=_t:ae?r=wt:_?r=Rt:r=bt,new r(n,gt)}function gt(n,r,s){var v=s.pointers.length,b=s.changedPointers.length,A=r&N&&v-b===0,D=r&(H|J)&&v-b===0;s.isFirst=!!A,s.isFinal=!!D,A&&(n.session={}),s.eventType=r,h(n,s),n.emit("hammer.input",s),n.recognize(s),n.session.prevInput=s}function h(n,r){var s=n.session,v=r.pointers,b=v.length;s.firstInput||(s.firstInput=ce(r)),b>1&&!s.firstMultiple?s.firstMultiple=ce(r):b===1&&(s.firstMultiple=!1);var A=s.firstInput,D=s.firstMultiple,ie=D?D.center:A.center,se=r.center=Re(v);r.timeStamp=d(),r.deltaTime=r.timeStamp-A.timeStamp,r.angle=It(ie,se),r.distance=yt(ie,se),I(s,r),r.offsetDirection=un(r.deltaX,r.deltaY);var he=Te(r.deltaTime,r.deltaX,r.deltaY);r.overallVelocityX=he.x,r.overallVelocityY=he.y,r.overallVelocity=m(he.x)>m(he.y)?he.x:he.y,r.scale=D?qn(D.pointers,v):1,r.rotation=D?Xn(D.pointers,v):0,r.maxPointers=s.prevInput?r.pointers.length>s.prevInput.maxPointers?r.pointers.length:s.prevInput.maxPointers:r.pointers.length,G(s,r);var xe=n.element;te(r.srcEvent.target,xe)&&(xe=r.srcEvent.target),r.target=xe}function I(n,r){var s=r.center,v=n.offsetDelta||{},b=n.prevDelta||{},A=n.prevInput||{};(r.eventType===N||A.eventType===H)&&(b=n.prevDelta={x:A.deltaX||0,y:A.deltaY||0},v=n.offsetDelta={x:s.x,y:s.y}),r.deltaX=b.x+(s.x-v.x),r.deltaY=b.y+(s.y-v.y)}function G(n,r){var s=n.lastInterval||r,v=r.timeStamp-s.timeStamp,b,A,D,ie;if(r.eventType!=J&&(v>W||s.velocity===i)){var se=r.deltaX-s.deltaX,he=r.deltaY-s.deltaY,xe=Te(v,se,he);A=xe.x,D=xe.y,b=m(xe.x)>m(xe.y)?xe.x:xe.y,ie=un(se,he),n.lastInterval=r}else b=s.velocity,A=s.velocityX,D=s.velocityY,ie=s.direction;r.velocity=b,r.velocityX=A,r.velocityY=D,r.direction=ie}function ce(n){for(var r=[],s=0;s<n.pointers.length;)r[s]={clientX:c(n.pointers[s].clientX),clientY:c(n.pointers[s].clientY)},s++;return{timeStamp:d(),pointers:r,center:Re(r),deltaX:n.deltaX,deltaY:n.deltaY}}function Re(n){var r=n.length;if(r===1)return{x:c(n[0].clientX),y:c(n[0].clientY)};for(var s=0,v=0,b=0;b<r;)s+=n[b].clientX,v+=n[b].clientY,b++;return{x:c(s/r),y:c(v/r)}}function Te(n,r,s){return{x:r/n||0,y:s/n||0}}function un(n,r){return n===r?Le:m(n)>=m(r)?n<0?Se:Ne:r<0?Ie:ke}function yt(n,r,s){s||(s=Qe);var v=r[s[0]]-n[s[0]],b=r[s[1]]-n[s[1]];return Math.sqrt(v*v+b*b)}function It(n,r,s){s||(s=Qe);var v=r[s[0]]-n[s[0]],b=r[s[1]]-n[s[1]];return Math.atan2(b,v)*180/Math.PI}function Xn(n,r){return It(r[1],r[0],_e)+It(n[1],n[0],_e)}function qn(n,r){return yt(r[0],r[1],_e)/yt(n[0],n[1],_e)}var Gn={mousedown:N,mousemove:oe,mouseup:H},$n="mousedown",Kn="mousemove mouseup";function bt(){this.evEl=$n,this.evWin=Kn,this.pressed=!1,ue.apply(this,arguments)}T(bt,ue,{handler:function(n){var r=Gn[n.type];r&N&&(n.button===0||n.button===2)&&(this.pressed=!0),r&oe&&n.which!==1&&(r=H),this.pressed&&(r&H&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:V,srcEvent:n}))}});var pn={pointerdown:N,pointermove:oe,pointerup:H,pointercancel:J,pointerout:J},Zn={2:Y,3:B,4:V,5:R},dn="pointerdown",hn="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(dn="MSPointerDown",hn="MSPointerMove MSPointerUp MSPointerCancel");function _t(){this.evEl=dn,this.evWin=hn,ue.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}T(_t,ue,{handler:function(n){var r=this.store,s=!1,v=!1,b=n.type.toLowerCase().replace("ms",""),A=pn[b],D=Zn[n.pointerType]||n.pointerType,ie=D==Y,se=re(r,n.pointerId,"pointerId");A&N&&(n.button===0||n.button===2||ie)?se<0&&(r.push(n),se=r.length-1):A&(H|J)?s=!0:!ie&&n.buttons===0&&(s=!0,v=!0,A=pn.pointerup),!(se<0)&&(v||(r[se]=n),this.callback(this.manager,A,{pointers:r,changedPointers:[n],pointerType:D,srcEvent:r[se]}),s&&r.splice(se,1))}});var Qn={touchstart:N,touchmove:oe,touchend:H,touchcancel:J},Jn="touchstart",ei="touchstart touchmove touchend touchcancel";function fn(){this.evTarget=Jn,this.evWin=ei,this.started=!1,ue.apply(this,arguments)}T(fn,ue,{handler:function(n){var r=Qn[n.type];if(r===N&&(this.started=!0),!!this.started){var s=ti.call(this,n,r);r&(H|J)&&s[0].length-s[1].length===0&&(this.started=!1),this.callback(this.manager,r,{pointers:s[0],changedPointers:s[1],pointerType:Y,srcEvent:n})}}});function ti(n,r){var s=pe(n.touches),v=pe(n.changedTouches);return r&(H|J)&&(s=ve(s.concat(v),"identifier")),[s,v]}var ni={touchstart:N,touchmove:oe,touchend:H,touchcancel:J},ii="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=ii,this.targetIds={},ue.apply(this,arguments)}T(wt,ue,{handler:function(n){var r=ni[n.type],s=oi.call(this,n,r);s&&this.callback(this.manager,r,{pointers:s[0],changedPointers:s[1],pointerType:Y,srcEvent:n})}});function oi(n,r){var s=pe(n.touches),v=this.targetIds;if(r&(N|oe)&&s.length===1)return v[s[0].identifier]=!0,[s,s];var b,A,D=pe(n.changedTouches),ie=[],se=this.target;if(A=s.filter(function(he){return te(he.target,se)}),r===N)for(b=0;b<A.length;)v[A[b].identifier]=!0,b++;for(b=0;b<D.length;)v[D[b].identifier]&&ie.push(D[b]),r&(H|J)&&delete v[D[b].identifier],b++;if(ie.length)return[ve(A.concat(ie),"identifier"),ie]}var ri=2500,mn=25;function Rt(){ue.apply(this,arguments);var n=g(this.handler,this);this.touch=new wt(this.manager,n),this.mouse=new bt(this.manager,n),this.primaryTouch=null,this.lastTouches=[]}T(Rt,ue,{handler:function(n,r,s){var v=s.pointerType==Y,b=s.pointerType==V;if(!(b&&s.sourceCapabilities&&s.sourceCapabilities.firesTouchEvents)){if(v)ai.call(this,r,s);else if(b&&si.call(this,s))return;this.callback(n,r,s)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ai(n,r){n&N?(this.primaryTouch=r.changedPointers[0].identifier,vn.call(this,r)):n&(H|J)&&vn.call(this,r)}function vn(n){var r=n.changedPointers[0];if(r.identifier===this.primaryTouch){var s={x:r.clientX,y:r.clientY};this.lastTouches.push(s);var v=this.lastTouches,b=function(){var A=v.indexOf(s);A>-1&&v.splice(A,1)};setTimeout(b,ri)}}function si(n){for(var r=n.srcEvent.clientX,s=n.srcEvent.clientY,v=0;v<this.lastTouches.length;v++){var b=this.lastTouches[v],A=Math.abs(r-b.x),D=Math.abs(s-b.y);if(A<=mn&&D<=mn)return!0}return!1}var gn=l?Q(l.style,"touchAction"):i,yn=gn!==i,bn="compute",wn="auto",Dt="manipulation",De="none",Je="pan-x",et="pan-y",xt=ci();function Bt(n,r){this.manager=n,this.set(r)}Bt.prototype={set:function(n){n==bn&&(n=this.compute()),yn&&this.manager.element.style&&xt[n]&&(this.manager.element.style[gn]=n),this.actions=n.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var n=[];return x(this.manager.recognizers,function(r){C(r.options.enable,[r])&&(n=n.concat(r.getTouchAction()))}),li(n.join(" "))},preventDefaults:function(n){var r=n.srcEvent,s=n.offsetDirection;if(this.manager.session.prevented){r.preventDefault();return}var v=this.actions,b=Z(v,De)&&!xt[De],A=Z(v,et)&&!xt[et],D=Z(v,Je)&&!xt[Je];if(b){var ie=n.pointers.length===1,se=n.distance<2,he=n.deltaTime<250;if(ie&&se&&he)return}if(!(D&&A)&&(b||A&&s&de||D&&s&ge))return this.preventSrc(r)},preventSrc:function(n){this.manager.session.prevented=!0,n.preventDefault()}};function li(n){if(Z(n,De))return De;var r=Z(n,Je),s=Z(n,et);return r&&s?De:r||s?r?Je:et:Z(n,Dt)?Dt:wn}function ci(){if(!yn)return!1;var n={},r=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(s){n[s]=r?a.CSS.supports("touch-action",s):!0}),n}var Ct=1,me=2,We=4,Ae=8,Ee=Ae,tt=16,we=32;function Pe(n){this.options=M({},this.defaults,n||{}),this.id=L(),this.manager=null,this.options.enable=p(this.options.enable,!0),this.state=Ct,this.simultaneous={},this.requireFail=[]}Pe.prototype={defaults:{},set:function(n){return M(this.options,n),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(n){if(y(n,"recognizeWith",this))return this;var r=this.simultaneous;return n=Tt(n,this),r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this},dropRecognizeWith:function(n){return y(n,"dropRecognizeWith",this)?this:(n=Tt(n,this),delete this.simultaneous[n.id],this)},requireFailure:function(n){if(y(n,"requireFailure",this))return this;var r=this.requireFail;return n=Tt(n,this),re(r,n)===-1&&(r.push(n),n.requireFailure(this)),this},dropRequireFailure:function(n){if(y(n,"dropRequireFailure",this))return this;n=Tt(n,this);var r=re(this.requireFail,n);return r>-1&&this.requireFail.splice(r,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(n){return!!this.simultaneous[n.id]},emit:function(n){var r=this,s=this.state;function v(b){r.manager.emit(b,n)}s<Ae&&v(r.options.event+xn(s)),v(r.options.event),n.additionalEvent&&v(n.additionalEvent),s>=Ae&&v(r.options.event+xn(s))},tryEmit:function(n){if(this.canEmit())return this.emit(n);this.state=we},canEmit:function(){for(var n=0;n<this.requireFail.length;){if(!(this.requireFail[n].state&(we|Ct)))return!1;n++}return!0},recognize:function(n){var r=M({},n);if(!C(this.options.enable,[this,r])){this.reset(),this.state=we;return}this.state&(Ee|tt|we)&&(this.state=Ct),this.state=this.process(r),this.state&(me|We|Ae|tt)&&this.tryEmit(r)},process:function(n){},getTouchAction:function(){},reset:function(){}};function xn(n){return n&tt?"cancel":n&Ae?"end":n&We?"move":n&me?"start":""}function Cn(n){return n==ke?"down":n==Ie?"up":n==Se?"left":n==Ne?"right":""}function Tt(n,r){var s=r.manager;return s?s.get(n):n}function ye(){Pe.apply(this,arguments)}T(ye,Pe,{defaults:{pointers:1},attrTest:function(n){var r=this.options.pointers;return r===0||n.pointers.length===r},process:function(n){var r=this.state,s=n.eventType,v=r&(me|We),b=this.attrTest(n);return v&&(s&J||!b)?r|tt:v||b?s&H?r|Ae:r&me?r|We:me:we}});function Et(){ye.apply(this,arguments),this.pX=null,this.pY=null}T(Et,ye,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ze},getTouchAction:function(){var n=this.options.direction,r=[];return n&de&&r.push(et),n&ge&&r.push(Je),r},directionTest:function(n){var r=this.options,s=!0,v=n.distance,b=n.direction,A=n.deltaX,D=n.deltaY;return b&r.direction||(r.direction&de?(b=A===0?Le:A<0?Se:Ne,s=A!=this.pX,v=Math.abs(n.deltaX)):(b=D===0?Le:D<0?Ie:ke,s=D!=this.pY,v=Math.abs(n.deltaY))),n.direction=b,s&&v>r.threshold&&b&r.direction},attrTest:function(n){return ye.prototype.attrTest.call(this,n)&&(this.state&me||!(this.state&me)&&this.directionTest(n))},emit:function(n){this.pX=n.deltaX,this.pY=n.deltaY;var r=Cn(n.direction);r&&(n.additionalEvent=this.options.event+r),this._super.emit.call(this,n)}});function zt(){ye.apply(this,arguments)}T(zt,ye,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(n){return this._super.attrTest.call(this,n)&&(Math.abs(n.scale-1)>this.options.threshold||this.state&me)},emit:function(n){if(n.scale!==1){var r=n.scale<1?"in":"out";n.additionalEvent=this.options.event+r}this._super.emit.call(this,n)}});function Wt(){Pe.apply(this,arguments),this._timer=null,this._input=null}T(Wt,Pe,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[wn]},process:function(n){var r=this.options,s=n.pointers.length===r.pointers,v=n.distance<r.threshold,b=n.deltaTime>r.time;if(this._input=n,!v||!s||n.eventType&(H|J)&&!b)this.reset();else if(n.eventType&N)this.reset(),this._timer=f(function(){this.state=Ee,this.tryEmit()},r.time,this);else if(n.eventType&H)return Ee;return we},reset:function(){clearTimeout(this._timer)},emit:function(n){this.state===Ee&&(n&&n.eventType&H?this.manager.emit(this.options.event+"up",n):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}});function Ut(){ye.apply(this,arguments)}T(Ut,ye,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(n){return this._super.attrTest.call(this,n)&&(Math.abs(n.rotation)>this.options.threshold||this.state&me)}});function Ht(){ye.apply(this,arguments)}T(Ht,ye,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:de|ge,pointers:1},getTouchAction:function(){return Et.prototype.getTouchAction.call(this)},attrTest:function(n){var r=this.options.direction,s;return r&(de|ge)?s=n.overallVelocity:r&de?s=n.overallVelocityX:r&ge&&(s=n.overallVelocityY),this._super.attrTest.call(this,n)&&r&n.offsetDirection&&n.distance>this.options.threshold&&n.maxPointers==this.options.pointers&&m(s)>this.options.velocity&&n.eventType&H},emit:function(n){var r=Cn(n.offsetDirection);r&&this.manager.emit(this.options.event+r,n),this.manager.emit(this.options.event,n)}});function Pt(){Pe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}T(Pt,Pe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Dt]},process:function(n){var r=this.options,s=n.pointers.length===r.pointers,v=n.distance<r.threshold,b=n.deltaTime<r.time;if(this.reset(),n.eventType&N&&this.count===0)return this.failTimeout();if(v&&b&&s){if(n.eventType!=H)return this.failTimeout();var A=this.pTime?n.timeStamp-this.pTime<r.interval:!0,D=!this.pCenter||yt(this.pCenter,n.center)<r.posThreshold;this.pTime=n.timeStamp,this.pCenter=n.center,!D||!A?this.count=1:this.count+=1,this._input=n;var ie=this.count%r.taps;if(ie===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Ee,this.tryEmit()},r.interval,this),me):Ee}return we},failTimeout:function(){return this._timer=f(function(){this.state=we},this.options.interval,this),we},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ee&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ue(n,r){return r=r||{},r.recognizers=p(r.recognizers,Ue.defaults.preset),new Yt(n,r)}Ue.VERSION="2.0.7",Ue.defaults={domEvents:!1,touchAction:bn,enable:!0,inputTarget:null,inputClass:null,preset:[[Ut,{enable:!1}],[zt,{enable:!1},["rotate"]],[Ht,{direction:de}],[Et,{direction:de},["swipe"]],[Pt],[Pt,{event:"doubletap",taps:2},["tap"]],[Wt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ui=1,Tn=2;function Yt(n,r){this.options=M({},Ue.defaults,r||{}),this.options.inputTarget=this.options.inputTarget||n,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=n,this.input=vt(this),this.touchAction=new Bt(this,this.options.touchAction),En(this,!0),x(this.options.recognizers,function(s){var v=this.add(new s[0](s[1]));s[2]&&v.recognizeWith(s[2]),s[3]&&v.requireFailure(s[3])},this)}Yt.prototype={set:function(n){return M(this.options,n),n.touchAction&&this.touchAction.update(),n.inputTarget&&(this.input.destroy(),this.input.target=n.inputTarget,this.input.init()),this},stop:function(n){this.session.stopped=n?Tn:ui},recognize:function(n){var r=this.session;if(!r.stopped){this.touchAction.preventDefaults(n);var s,v=this.recognizers,b=r.curRecognizer;(!b||b&&b.state&Ee)&&(b=r.curRecognizer=null);for(var A=0;A<v.length;)s=v[A],r.stopped!==Tn&&(!b||s==b||s.canRecognizeWith(b))?s.recognize(n):s.reset(),!b&&s.state&(me|We|Ae)&&(b=r.curRecognizer=s),A++}},get:function(n){if(n instanceof Pe)return n;for(var r=this.recognizers,s=0;s<r.length;s++)if(r[s].options.event==n)return r[s];return null},add:function(n){if(y(n,"add",this))return this;var r=this.get(n.options.event);return r&&this.remove(r),this.recognizers.push(n),n.manager=this,this.touchAction.update(),n},remove:function(n){if(y(n,"remove",this))return this;if(n=this.get(n),n){var r=this.recognizers,s=re(r,n);s!==-1&&(r.splice(s,1),this.touchAction.update())}return this},on:function(n,r){if(n!==i&&r!==i){var s=this.handlers;return x(ne(n),function(v){s[v]=s[v]||[],s[v].push(r)}),this}},off:function(n,r){if(n!==i){var s=this.handlers;return x(ne(n),function(v){r?s[v]&&s[v].splice(re(s[v],r),1):delete s[v]}),this}},emit:function(n,r){this.options.domEvents&&pi(n,r);var s=this.handlers[n]&&this.handlers[n].slice();if(!(!s||!s.length)){r.type=n,r.preventDefault=function(){r.srcEvent.preventDefault()};for(var v=0;v<s.length;)s[v](r),v++}},destroy:function(){this.element&&En(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function En(n,r){var s=n.element;if(s.style){var v;x(n.options.cssProps,function(b,A){v=Q(s.style,A),r?(n.oldCssProps[v]=s.style[v],s.style[v]=b):s.style[v]=n.oldCssProps[v]||""}),r||(n.oldCssProps={})}}function pi(n,r){var s=o.createEvent("Event");s.initEvent(n,!0,!0),s.gesture=r,r.target.dispatchEvent(s)}return M(Ue,{INPUT_START:N,INPUT_MOVE:oe,INPUT_END:H,INPUT_CANCEL:J,STATE_POSSIBLE:Ct,STATE_BEGAN:me,STATE_CHANGED:We,STATE_ENDED:Ae,STATE_RECOGNIZED:Ee,STATE_CANCELLED:tt,STATE_FAILED:we,DIRECTION_NONE:Le,DIRECTION_LEFT:Se,DIRECTION_RIGHT:Ne,DIRECTION_UP:Ie,DIRECTION_DOWN:ke,DIRECTION_HORIZONTAL:de,DIRECTION_VERTICAL:ge,DIRECTION_ALL:Ze,Manager:Yt,Input:ue,TouchAction:Bt,TouchInput:wt,MouseInput:bt,PointerEventInput:_t,TouchMouseInput:Rt,SingleTouchInput:fn,Recognizer:Pe,AttrRecognizer:ye,Tap:Pt,Pan:Et,Swipe:Ht,Pinch:zt,Rotate:Ut,Press:Wt,on:w,off:k,each:x,merge:O,extend:S,assign:M,inherit:T,bindFn:g,prefixed:Q}),Ue}(typeof window<"u"?window:{},typeof document<"u"?document:{}),ct=function(a,o){o===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=a,this.domElement=o,this.enabled=!0,this.target=new z,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:je.ROTATE,MIDDLE:je.DOLLY,RIGHT:je.PAN},this.touches={ONE:Fe.ROTATE,TWO:Fe.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(i),e.update(),c=u.NONE},this.update=function(){var h=new z,I=new Pn().setFromUnitVectors(a.up,new z(0,1,0)),G=I.clone().inverse(),ce=new z,Re=new Pn;return function(){var Te=e.object.position;return h.copy(Te).sub(e.target),h.applyQuaternion(I),d.setFromVector3(h),e.autoRotate&&c===u.NONE&&ne(te()),e.enableDamping?(d.theta+=f.theta*e.dampingFactor,d.phi+=f.phi*e.dampingFactor):(d.theta+=f.theta,d.phi+=f.phi),d.theta=Math.max(e.minAzimuthAngle,Math.min(e.maxAzimuthAngle,d.theta)),d.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=y,d.radius=Math.max(e.minDistance,Math.min(e.maxDistance,d.radius)),e.enableDamping===!0?e.target.addScaledVector(x,e.dampingFactor):e.target.add(x),h.setFromSpherical(d),h.applyQuaternion(G),Te.copy(e.target).add(h),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,x.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),x.set(0,0,0)),y=1,E||ce.distanceToSquared(e.object.position)>m||8*(1-Re.dot(e.object.quaternion))>m?(e.dispatchEvent(i),ce.copy(e.object.position),Re.copy(e.object.quaternion),E=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",gt,!1),e.domElement.removeEventListener("mousedown",ke,!1),e.domElement.removeEventListener("wheel",Ze,!1),e.domElement.removeEventListener("touchstart",_e,!1),e.domElement.removeEventListener("touchend",vt,!1),e.domElement.removeEventListener("touchmove",ue,!1),document.removeEventListener("mousemove",de,!1),document.removeEventListener("mouseup",ge,!1),e.domElement.removeEventListener("keydown",Qe,!1)};var e=this,i={type:"change"},t={type:"start"},l={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},c=u.NONE,m=1e-6,d=new Mn,f=new Mn,y=1,x=new z,E=!1,M=new Ce,S=new Ce,O=new Ce,T=new Ce,g=new Ce,C=new Ce,p=new Ce,w=new Ce,k=new Ce;function te(){return 2*Math.PI/60/60*e.autoRotateSpeed}function Z(){return Math.pow(.95,e.zoomSpeed)}function ne(h){f.theta-=h}function re(h){f.phi-=h}var pe=function(){var h=new z;return function(I,G){h.setFromMatrixColumn(G,0),h.multiplyScalar(-I),x.add(h)}}(),ve=function(){var h=new z;return function(I,G){e.screenSpacePanning===!0?h.setFromMatrixColumn(G,1):(h.setFromMatrixColumn(G,0),h.crossVectors(e.object.up,h)),h.multiplyScalar(I),x.add(h)}}(),Q=function(){var h=new z;return function(I,G){var ce=e.domElement;if(e.object.isPerspectiveCamera){var Re=e.object.position;h.copy(Re).sub(e.target);var Te=h.length();Te*=Math.tan(e.object.fov/2*Math.PI/180),pe(2*I*Te/ce.clientHeight,e.object.matrix),ve(2*G*Te/ce.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(pe(I*(e.object.right-e.object.left)/e.object.zoom/ce.clientWidth,e.object.matrix),ve(G*(e.object.top-e.object.bottom)/e.object.zoom/ce.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function q(h){e.object.isPerspectiveCamera?y/=h:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*h)),e.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function L(h){e.object.isPerspectiveCamera?y*=h:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),E=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function j(h){M.set(h.clientX,h.clientY)}function F(h){p.set(h.clientX,h.clientY)}function _(h){T.set(h.clientX,h.clientY)}function U(h){S.set(h.clientX,h.clientY),O.subVectors(S,M).multiplyScalar(e.rotateSpeed);var I=e.domElement;ne(2*Math.PI*O.x/I.clientHeight),re(2*Math.PI*O.y/I.clientHeight),M.copy(S),e.update()}function ae(h){w.set(h.clientX,h.clientY),k.subVectors(w,p),k.y>0?q(Z()):k.y<0&&L(Z()),p.copy(w),e.update()}function Y(h){g.set(h.clientX,h.clientY),C.subVectors(g,T).multiplyScalar(e.panSpeed),Q(C.x,C.y),T.copy(g),e.update()}function B(h){h.deltaY<0?L(Z()):h.deltaY>0&&q(Z()),e.update()}function V(h){var I=!1;switch(h.keyCode){case e.keys.UP:Q(0,e.keyPanSpeed),I=!0;break;case e.keys.BOTTOM:Q(0,-e.keyPanSpeed),I=!0;break;case e.keys.LEFT:Q(e.keyPanSpeed,0),I=!0;break;case e.keys.RIGHT:Q(-e.keyPanSpeed,0),I=!0;break}I&&(h.preventDefault(),e.update())}function R(h){if(h.touches.length==1)M.set(h.touches[0].pageX,h.touches[0].pageY);else{var I=.5*(h.touches[0].pageX+h.touches[1].pageX),G=.5*(h.touches[0].pageY+h.touches[1].pageY);M.set(I,G)}}function W(h){if(h.touches.length==1)T.set(h.touches[0].pageX,h.touches[0].pageY);else{var I=.5*(h.touches[0].pageX+h.touches[1].pageX),G=.5*(h.touches[0].pageY+h.touches[1].pageY);T.set(I,G)}}function N(h){var I=h.touches[0].pageX-h.touches[1].pageX,G=h.touches[0].pageY-h.touches[1].pageY,ce=Math.sqrt(I*I+G*G);p.set(0,ce)}function oe(h){e.enableZoom&&N(h),e.enablePan&&W(h)}function H(h){e.enableZoom&&N(h),e.enableRotate&&R(h)}function J(h){if(h.touches.length==1)S.set(h.touches[0].pageX,h.touches[0].pageY);else{var I=.5*(h.touches[0].pageX+h.touches[1].pageX),G=.5*(h.touches[0].pageY+h.touches[1].pageY);S.set(I,G)}O.subVectors(S,M).multiplyScalar(e.rotateSpeed);var ce=e.domElement;ne(2*Math.PI*O.x/ce.clientHeight),re(2*Math.PI*O.y/ce.clientHeight),M.copy(S)}function Le(h){if(h.touches.length==1)g.set(h.touches[0].pageX,h.touches[0].pageY);else{var I=.5*(h.touches[0].pageX+h.touches[1].pageX),G=.5*(h.touches[0].pageY+h.touches[1].pageY);g.set(I,G)}C.subVectors(g,T).multiplyScalar(e.panSpeed),Q(C.x,C.y),T.copy(g)}function Se(h){var I=h.touches[0].pageX-h.touches[1].pageX,G=h.touches[0].pageY-h.touches[1].pageY,ce=Math.sqrt(I*I+G*G);w.set(0,ce),k.set(0,Math.pow(w.y/p.y,e.zoomSpeed)),q(k.y),p.copy(w)}function Ne(h){e.enableZoom&&Se(h),e.enablePan&&Le(h)}function Ie(h){e.enableZoom&&Se(h),e.enableRotate&&J(h)}function ke(h){if(e.enabled!==!1){h.preventDefault(),e.domElement.focus?e.domElement.focus():window.focus();var I;switch(h.button){case 0:I=e.mouseButtons.LEFT;break;case 1:I=e.mouseButtons.MIDDLE;break;case 2:I=e.mouseButtons.RIGHT;break;default:I=-1}switch(I){case je.DOLLY:if(e.enableZoom===!1)return;F(h),c=u.DOLLY;break;case je.ROTATE:if(h.ctrlKey||h.metaKey||h.shiftKey){if(e.enablePan===!1)return;_(h),c=u.PAN}else{if(e.enableRotate===!1)return;j(h),c=u.ROTATE}break;case je.PAN:if(h.ctrlKey||h.metaKey||h.shiftKey){if(e.enableRotate===!1)return;j(h),c=u.ROTATE}else{if(e.enablePan===!1)return;_(h),c=u.PAN}break;default:c=u.NONE}c!==u.NONE&&(document.addEventListener("mousemove",de,!1),document.addEventListener("mouseup",ge,!1),e.dispatchEvent(t))}}function de(h){if(e.enabled!==!1)switch(h.preventDefault(),c){case u.ROTATE:if(e.enableRotate===!1)return;U(h);break;case u.DOLLY:if(e.enableZoom===!1)return;ae(h);break;case u.PAN:if(e.enablePan===!1)return;Y(h);break}}function ge(h){e.enabled!==!1&&(document.removeEventListener("mousemove",de,!1),document.removeEventListener("mouseup",ge,!1),e.dispatchEvent(l),c=u.NONE)}function Ze(h){e.enabled===!1||e.enableZoom===!1||c!==u.NONE&&c!==u.ROTATE||(h.preventDefault(),h.stopPropagation(),e.dispatchEvent(t),B(h),e.dispatchEvent(l))}function Qe(h){e.enabled===!1||e.enableKeys===!1||e.enablePan===!1||V(h)}function _e(h){if(e.enabled!==!1){switch(h.preventDefault(),h.touches.length){case 1:switch(e.touches.ONE){case Fe.ROTATE:if(e.enableRotate===!1)return;R(h),c=u.TOUCH_ROTATE;break;case Fe.PAN:if(e.enablePan===!1)return;W(h),c=u.TOUCH_PAN;break;default:c=u.NONE}break;case 2:switch(e.touches.TWO){case Fe.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;oe(h),c=u.TOUCH_DOLLY_PAN;break;case Fe.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;H(h),c=u.TOUCH_DOLLY_ROTATE;break;default:c=u.NONE}break;default:c=u.NONE}c!==u.NONE&&e.dispatchEvent(t)}}function ue(h){if(e.enabled!==!1)switch(h.preventDefault(),h.stopPropagation(),c){case u.TOUCH_ROTATE:if(e.enableRotate===!1)return;J(h),e.update();break;case u.TOUCH_PAN:if(e.enablePan===!1)return;Le(h),e.update();break;case u.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ne(h),e.update();break;case u.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ie(h),e.update();break;default:c=u.NONE}}function vt(h){e.enabled!==!1&&(e.dispatchEvent(l),c=u.NONE)}function gt(h){e.enabled!==!1&&h.preventDefault()}e.domElement.addEventListener("contextmenu",gt,!1),e.domElement.addEventListener("mousedown",ke,!1),e.domElement.addEventListener("wheel",Ze,!1),e.domElement.addEventListener("touchstart",_e,!1),e.domElement.addEventListener("touchend",vt,!1),e.domElement.addEventListener("touchmove",ue,!1),e.domElement.addEventListener("keydown",Qe,!1),e.domElement.tabIndex===-1&&(e.domElement.tabIndex=0),this.update()};ct.prototype=Object.create(zn.prototype);ct.prototype.constructor=ct;var on=function(a,o){ct.call(this,a,o),this.mouseButtons.LEFT=je.PAN,this.mouseButtons.RIGHT=je.ROTATE,this.touches.ONE=Fe.PAN,this.touches.TWO=Fe.DOLLY_ROTATE};on.prototype=Object.create(zn.prototype);on.prototype.constructor=on;var Me=function(a){Wn.call(this),this.element=a,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",function(){this.traverse(function(o){o.element instanceof Element&&o.element.parentNode!==null&&o.element.parentNode.removeChild(o.element)})})};Me.prototype=Object.create(Wn.prototype);Me.prototype.constructor=Me;var Lt=function(a){Me.call(this,a)};Lt.prototype=Object.create(Me.prototype);Lt.prototype.constructor=Lt;var rr=function(){var a=this,o,e,i,t,l=new Un,u={camera:{fov:0,style:""},objects:new WeakMap},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c;var m=document.createElement("div");m.style.WebkitTransformStyle="preserve-3d",m.style.transformStyle="preserve-3d",m.style.pointerEvents="none",c.appendChild(m);var d=/Trident/i.test(navigator.userAgent);this.getSize=function(){return{width:o,height:e}},this.setSize=function(T,g){o=T,e=g,i=o/2,t=e/2,c.style.width=T+"px",c.style.height=g+"px",m.style.width=T+"px",m.style.height=g+"px"};function f(T){return Math.abs(T)<1e-10?0:T}function y(T){var g=T.elements;return"matrix3d("+f(g[0])+","+f(-g[1])+","+f(g[2])+","+f(g[3])+","+f(g[4])+","+f(-g[5])+","+f(g[6])+","+f(g[7])+","+f(g[8])+","+f(-g[9])+","+f(g[10])+","+f(g[11])+","+f(g[12])+","+f(-g[13])+","+f(g[14])+","+f(g[15])+")"}function x(T,g){var C=T.elements,p="matrix3d("+f(C[0])+","+f(C[1])+","+f(C[2])+","+f(C[3])+","+f(-C[4])+","+f(-C[5])+","+f(-C[6])+","+f(-C[7])+","+f(C[8])+","+f(C[9])+","+f(C[10])+","+f(C[11])+","+f(C[12])+","+f(C[13])+","+f(C[14])+","+f(C[15])+")";return d?"translate(-50%,-50%)translate("+i+"px,"+t+"px)"+g+p:"translate(-50%,-50%)"+p}function E(T,g,C,p){if(T instanceof Me){T.onBeforeRender(a,g,C);var w;T instanceof Lt?(l.copy(C.matrixWorldInverse),l.transpose(),l.copyPosition(T.matrixWorld),l.scale(T.scale),l.elements[3]=0,l.elements[7]=0,l.elements[11]=0,l.elements[15]=1,w=x(l,p)):w=x(T.matrixWorld,p);var k=T.element,te=u.objects.get(T);if(te===void 0||te.style!==w){k.style.WebkitTransform=w,k.style.transform=w;var Z={style:w};d&&(Z.distanceToCameraSquared=M(C,T)),u.objects.set(T,Z)}k.style.display=T.visible?"":"none",k.parentNode!==m&&m.appendChild(k),T.onAfterRender(a,g,C)}for(var ne=0,re=T.children.length;ne<re;ne++)E(T.children[ne],g,C,p)}var M=function(){var T=new z,g=new z;return function(C,p){return T.setFromMatrixPosition(C.matrixWorld),g.setFromMatrixPosition(p.matrixWorld),T.distanceToSquared(g)}}();function S(T){var g=[];return T.traverse(function(C){C instanceof Me&&g.push(C)}),g}function O(T){for(var g=S(T).sort(function(k,te){var Z=u.objects.get(k).distanceToCameraSquared,ne=u.objects.get(te).distanceToCameraSquared;return Z-ne}),C=g.length,p=0,w=g.length;p<w;p++)g[p].element.style.zIndex=C-p}this.render=function(T,g){var C=g.projectionMatrix.elements[5]*t;if(u.camera.fov!==C&&(g.isPerspectiveCamera?(c.style.WebkitPerspective=C+"px",c.style.perspective=C+"px"):(c.style.WebkitPerspective="",c.style.perspective=""),u.camera.fov=C),T.autoUpdate===!0&&T.updateMatrixWorld(),g.parent===null&&g.updateMatrixWorld(),g.isOrthographicCamera)var p=-(g.right+g.left)/2,w=(g.top+g.bottom)/2;var k=g.isOrthographicCamera?"scale("+C+")translate("+f(p)+"px,"+f(w)+"px)"+y(g.matrixWorldInverse):"translateZ("+C+"px)"+y(g.matrixWorldInverse),te=k+"translate("+i+"px,"+t+"px)";u.camera.style!==te&&!d&&(m.style.WebkitTransform=te,m.style.transform=te,u.camera.style=te),E(T,T,g,k),d&&O(T)}};function Rn(a,o,e){var i=o.getBoundingClientRect(),t=i.top,l=i.left,u=i.width,c=i.height;return new Ce((a.x-l)/u*2-1,-(a.y-t)/c*2+1)}var ar=function(a){Ke(o,a);function o(e,i,t,l,u){var c=a.call(this)||this;c.type="RoundedBoxGeometry",u=isNaN(u)?1:Math.max(1,Math.floor(u)),e=isNaN(e)?1:e,i=isNaN(i)?1:i,t=isNaN(t)?1:t,l=isNaN(l)?.15:l,l=Math.min(l,Math.min(e,Math.min(i,Math.min(t)))/2);var m=e/2-l,d=i/2-l,f=t/2-l;c.parameters={width:e,height:i,depth:t,radius:l,radiusSegments:u};var y=u+1,x=y*u+1<<3,E=new Vt(new Float32Array(x*3),3),M=new Vt(new Float32Array(x*3),3),S=[],O=[],T=new z,g=[],C=[],p=[],w=y*u,k=y*u+1;te(),ne(),Z(),re(),ve(),pe();function te(){for(var L=[new z(1,1,1),new z(1,1,-1),new z(-1,1,-1),new z(-1,1,1),new z(1,-1,1),new z(1,-1,-1),new z(-1,-1,-1),new z(-1,-1,1)],j=0;j<8;j++)S.push([]),O.push([]);for(var F=Math.PI/2,_=new z(m,d,f),U=0;U<=u;U++){var ae=U/u,Y=ae*F,B=Math.cos(Y),V=Math.sin(Y);if(U==u){T.set(0,1,0);var R=T.clone().multiplyScalar(l).add(_);S[0].push(R),g.push(R);var W=T.clone();O[0].push(W),C.push(W);continue}for(var N=0;N<=u;N++){var oe=N/u,H=oe*F;T.x=B*Math.cos(H),T.y=V,T.z=B*Math.sin(H);var R=T.clone().multiplyScalar(l).add(_);S[0].push(R),g.push(R);var W=T.clone().normalize();O[0].push(W),C.push(W)}}for(var J=1;J<8;J++)for(var j=0;j<S[0].length;j++){var R=S[0][j].clone().multiply(L[J]);S[J].push(R),g.push(R);var W=O[0][j].clone().multiply(L[J]);O[J].push(W),C.push(W)}}function Z(){for(var L=[!0,!1,!0,!1,!1,!0,!1,!0],j=y*(u-1),F=0;F<8;F++){for(var _=k*F,U=0;U<u-1;U++)for(var ae=U*y,Y=(U+1)*y,B=0;B<u;B++){var V=B+1,R=_+ae+B,W=_+ae+V,N=_+Y+B,oe=_+Y+V;L[F]?(p.push(R),p.push(N),p.push(W),p.push(W),p.push(N),p.push(oe)):(p.push(R),p.push(W),p.push(N),p.push(W),p.push(oe),p.push(N))}for(var B=0;B<u;B++){var R=_+j+B,W=_+j+B+1,N=_+w;L[F]?(p.push(R),p.push(N),p.push(W)):(p.push(R),p.push(W),p.push(N))}}}function ne(){var L=w,j=w+k,F=w+k*2,_=w+k*3;p.push(L),p.push(j),p.push(F),p.push(L),p.push(F),p.push(_),L=w+k*4,j=w+k*5,F=w+k*6,_=w+k*7,p.push(L),p.push(F),p.push(j),p.push(L),p.push(_),p.push(F),L=0,j=k,F=k*4,_=k*5,p.push(L),p.push(F),p.push(j),p.push(j),p.push(F),p.push(_),L=k*2,j=k*3,F=k*6,_=k*7,p.push(L),p.push(F),p.push(j),p.push(j),p.push(F),p.push(_),L=u,j=u+k*3,F=u+k*4,_=u+k*7,p.push(L),p.push(j),p.push(F),p.push(j),p.push(_),p.push(F),L=u+k,j=u+k*2,F=u+k*5,_=u+k*6,p.push(L),p.push(F),p.push(j),p.push(j),p.push(F),p.push(_)}function re(){for(var L=0;L<4;L++)for(var j=L*k,F=4*k+j,_=(L&1)===1,U=0;U<u;U++){var ae=U+1,Y=j+U,B=j+ae,V=F+U,R=F+ae;_?(p.push(Y),p.push(V),p.push(B),p.push(B),p.push(V),p.push(R)):(p.push(Y),p.push(B),p.push(V),p.push(B),p.push(R),p.push(V))}}function pe(){for(var L=[0,2,4,6],j=[1,3,5,7],F=0;F<4;F++)for(var _=k*L[F],U=k*j[F],ae=1>=F,Y=0;Y<u;Y++){var B=Y*y,V=(Y+1)*y,R=_+B,W=_+V,N=U+B,oe=U+V;ae?(p.push(R),p.push(N),p.push(W),p.push(W),p.push(N),p.push(oe)):(p.push(R),p.push(W),p.push(N),p.push(W),p.push(oe),p.push(N))}}function ve(){for(var L=u-1,j=[0,1,4,5],F=[3,2,7,6],_=[0,1,1,0],U=0;U<4;U++)for(var ae=j[U]*k,Y=F[U]*k,B=0;B<=L;B++){var V=ae+u+B*y,R=ae+(B!=L?u+(B+1)*y:k-1),W=Y+u+B*y,N=Y+(B!=L?u+(B+1)*y:k-1);_[U]?(p.push(V),p.push(W),p.push(R),p.push(R),p.push(W),p.push(N)):(p.push(V),p.push(R),p.push(W),p.push(R),p.push(N),p.push(W))}}for(var Q=0,q=0;q<g.length;q++)E.setXYZ(Q,g[q].x,g[q].y,g[q].z),M.setXYZ(Q,C[q].x,C[q].y,C[q].z),Q++;return c.setIndex(new Vt(new Uint16Array(p),1)),c.setAttribute("position",E),c.setAttribute("normal",M),c}return o}(vi);function it(a,o){return typeof a!="number"||typeof o!="number"?!1:Math.abs(a-o)<.001}function ot(a,o,e,i){i===void 0&&(i=function(l){return l});var t=i(e);return a*(1-t)+o*t}var le=Number((Math.PI/2).toFixed(5));function sr(a,o,e){var i=new gi;return i.moveTo(e,0),i.lineTo(a-e,0),i.absarc(a-e,e,e,-le,0,!1),i.lineTo(a,o-e),i.absarc(a-e,o-e,e,0,le,!1),i.lineTo(e,o),i.absarc(e,o-e,e,le,Math.PI,!1),i.lineTo(0,e),i.absarc(e,e,e,Math.PI,Math.PI*1.5,!1),i}var rt=function(a){var o=document.createElement("div");o.innerText=a;var e=new Me(o);return e.name=a,e.scale.set(.3,.3,.3),o.style.pointerEvents="none",o.style.backfaceVisibility="hidden",e},St=function(a){var o=new yi(5,5),e=new Ye({transparent:!0,opacity:0}),i=new be(o,e),t=document.createElement("div");t.innerText=a;var l=new Me(t);return l.name=a,l.scale.set(.3,.3,.3),t.style.color="#ffffff",t.style.opacity="0.5",t.style.pointerEvents="none",t.style.backfaceVisibility="hidden",i.rotateX(-le),i.add(l),i},lr=function(a){Ke(o,a);function o(e,i){var t=a.call(this,e)||this;t.camera=new bi(90),t.scene=new wi,t.renderer=new xi({antialias:!0,alpha:!0}),t.css3drenderer=new rr,t.ambientLight=new Ci(16777215,.7),t.wrapper=document.createElement("div"),t.arrows=document.createElement("div"),t.arrowLeft=document.createElement("div"),t.arrowRight=document.createElement("div"),t.arrowFront=document.createElement("div"),t.arrowBack=document.createElement("div"),t.arrowTop=document.createElement("div"),t.arrowBottom=document.createElement("div"),t.spherical=null,t.dragging=!1,t.style=document.createElement("style"),t.directionalLight=new Ti(16777215,.2),t.box=new be(new ar(8,8,8,.5,20),new Ei({color:16777215})),t.faces=new Nt,t.orient=function(c){var m=c.longitude,d=c.latitude;t.dragging=!1,t.spherical=null,t.controls.enableDamping=!1,t.five.setState(Object.assign({latitude:d},m!==void 0?{longitude:m+t.config.fixedLongitude}:{})),t.five.ready().then(function(){t.controls.enableDamping=!0,t.setState({arrowsVisible:!0})})},t.onRenderFrame=function(){var c,m,d,f,y;if(t.renderer.render(t.scene,t.camera),t.css3drenderer.render(t.scene,t.camera),t.directionalLight.position.copy(t.camera.position),(c=t.controls)===null||c===void 0||c.update(),t.dragging){t.camera.computePose(),t.updateByCamera();var x=t.camera.pose,E=x.longitude,M=x.latitude;t.five.setState({longitude:E,latitude:M},!0),t.updateArrows({longitude:E,latitude:M})}else if(t.spherical&&(!it(t.spherical.pi,(m=t.controls)===null||m===void 0?void 0:m.getPolarAngle())||!it(t.spherical.theta,(d=t.controls)===null||d===void 0?void 0:d.getAzimuthalAngle()))){t.spherical={pi:(f=t.controls)===null||f===void 0?void 0:f.getPolarAngle(),theta:(y=t.controls)===null||y===void 0?void 0:y.getAzimuthalAngle()},t.camera.computePose(),t.updateByCamera();var S=t.camera.pose,E=S.longitude,M=S.latitude;t.five.setState({longitude:E,latitude:M},!0),t.updateArrows({longitude:E,latitude:M})}else t.spherical=null},t.onTapGesture=function(c){var m=c.pointers[0].clientX,d=c.pointers[0].clientY,f=Rn({x:m,y:d},t.wrapper),y=new Sn;y.setFromCamera(f,t.camera);var x=y.intersectObjects(t.faces.children,!1)[0];if(x){var E=x.object.userData,M=E.longitude,S=E.latitude;t.orient({longitude:M,latitude:S})}},t.onFiveWantsGesture=function(){if(t.spherical)return!1},t.onFiveModeChange=function(c){t.controls&&(t.controls.maxPolarAngle=c==="Topview"?0:le)},t.onCameraUpdate=function(c){var m=c.state;if(!t.dragging&&!t.spherical){var d=m.longitude,f=m.latitude;t.camera.pose.longitude===d&&t.camera.pose.latitude===f||(t.camera.setFromPose({longitude:d,latitude:f,distance:20,offset:new z(0,0,0)}),t.updateByCamera(),t.updateArrows({longitude:d,latitude:f}))}},t.onPanStart=function(c){t.dragging=!0,t.spherical={}},t.onMouseMove=function(c){if(!t.dragging){var m=Rn({x:c.clientX,y:c.clientY},t.wrapper),d=new Sn;d.setFromCamera(m,t.camera);var f=d.intersectObjects(t.faces.children,!1)[0];t.faces.children.forEach(function(y){y.material.opacity=0,y.children[0].element.style.color=""}),f&&(f.object.material.opacity=.3,f.object.children[0].element.style.color="#336dff")}},t.onPanEnd=function(c){t.dragging=!1,t.spherical={pi:t.controls.getPolarAngle(),theta:t.controls.getAzimuthalAngle()}},t.dispose=function(){t.disable()},t.five=e;var l={enabled:!1,visible:!0,arrowsVisible:!1};t.state=Object.assign(l,i==null?void 0:i.initialState);var u=K({fixedLongitude:0,orthoView:!0},i==null?void 0:i.config);return t._config=u,t.state.enabled&&t._enable({userAction:!1}),t.mc=new $t.Manager(t.wrapper),t.mc.add(new $t.Tap({interval:410})),t.mc.add(new $t.Pan({threshold:10,pointers:0})),t.camera.setFromPose({distance:20,offset:new z(0,0,0),longitude:e.camera.pose.latitude,latitude:e.camera.pose.latitude}),t.cylinder=new be(new en(13.2,14,.01,50,1,!0),new jt({uniforms:{radiusTop:{value:13.2},radiusBottom:{value:14},opacity:{value:1}},vertexShader:`
          varying vec3 pos;
          varying mat4 vViewMatrix;
          void main() {
            pos = position;
            vViewMatrix = viewMatrix;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          varying vec3 pos;
          varying mat4 vViewMatrix;
          uniform float radiusTop;
          uniform float radiusBottom;
          uniform float opacity;
          void main() {
            mat3 cameraRotationMatrix = mat3(vViewMatrix[0][0], vViewMatrix[1][0], vViewMatrix[2][0], vViewMatrix[0][1], vViewMatrix[1][1], vViewMatrix[2][1], vViewMatrix[0][2], vViewMatrix[1][2], vViewMatrix[2][2]);
            vec3 cameraDirection = normalize(cameraRotationMatrix * vec3(0.0, 0.0, 1.0));
            float dis = length(vec3(pos.x, 0, pos.z));
            // if (dis < radiusTop + 0.05 || dis > radiusBottom - 0.05) {
            //   gl_FragColor = vec4(1.0, 1.0, 1.0, 0.6 * opacity);
            //   return;
            // }
            vec4 color1 = vec4(1.0, 1.0, 1.0, 0.05);
            vec4 color2 = vec4(1.0, 1.0, 1.0, 0.3 * opacity);

            float z = abs(pos.z) / radiusBottom;

            vec4 color = mix(color1, color2, z);
            gl_FragColor = color;
          }
        `,transparent:!0})),t.init(),t}return Object.defineProperty(o.prototype,"config",{get:function(){return K({},this._config)},enumerable:!1,configurable:!0}),o.prototype.updateState=function(e,i){var t=this.state;this.state=K(K({},this.state),e),typeof e.arrowsVisible=="boolean"&&this.handleArrowsVisible(e.arrowsVisible),this.hooks.emit("stateChange",{state:this.state,prevState:t,userAction:i})},o.prototype.appendTo=function(e){if(e){e.appendChild(this.wrapper);var i=this.wrapper.getBoundingClientRect(),t=i.width,l=i.height;this.renderer.setSize(t,l),this.css3drenderer.setSize(t,l)}},o.prototype.init=function(){this.renderer.setClearAlpha(0),this.renderer.domElement.style.outline="none",this.initDom(),this.initFaces(),this.initControls(),this.initLights();var e=this.cylinder;e.position.y=-3;var i=St("西");i.position.set(-19,0,0),e.add(i);var t=St("东");t.position.set(19,0,0),e.add(t);var l=St("北");l.position.set(0,0,-19),e.add(l);var u=St("南");u.position.set(0,0,19),e.add(u),this.updateByCamera(),this.scene.add(e,this.box,this.faces),this.scene.rotation.y=this.config.fixedLongitude},o.prototype.initDom=function(){this.style.innerHTML=`
      .OrientationPlugin .OrientationArrows {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        pointer-events: none;
        width: 70%;
        height: 70%;
        display: none;
      }

      .OrientationPlugin .active {
        color: #0F1014;
      }

      .OrientationPlugin .OrientationArrow {
        position: absolute;
        pointer-events: auto;
        --color: #fff;
        color: var(--color);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        line-height: 12px;
        width: 20px;
        height: 20px;
        margin: auto;
        user-select: none;
        cursor: pointer;
      }

      .OrientationPlugin .disabled {
        opacity: 0.2;
        pointer-events: none;
      }

      .OrientationPlugin .OrientationArrow:active, .OrientationPlugin .OrientationArrow:hover {
        --color: #336dff;
      }

      .OrientationPlugin .OrientationArrow::after {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        margin: auto;
        border-style: solid;
      }

      .OrientationPlugin .OrientationArrow:nth-child(1) {
        top: 0;
        right: 0;
        left: 0;
      }

      .OrientationPlugin .OrientationArrow:nth-child(1)::after {
        border-width: 5px 6px;
        border-color: var(--color) transparent transparent transparent;
        transform: translate(0, 15px);
      }

      .OrientationPlugin .OrientationArrow:nth-child(2) {
        top: 0;
        bottom: 0;
        left: 0;
      }

      .OrientationPlugin .OrientationArrow:nth-child(2)::after {
        border-width: 6px 5px;
        border-color: transparent transparent transparent var(--color);
        transform: translate(15px, 0);
      }

      .OrientationPlugin .OrientationArrow:nth-child(3) {
        top: 0;
        right: 0;
        bottom: 0;
      }
      
      .OrientationPlugin .OrientationArrow:nth-child(3)::after {
        border-width: 6px 5px;
        border-color: transparent var(--color) transparent transparent;
        transform: translate(-15px, 0);
      }

      .OrientationPlugin .OrientationArrow:nth-child(4) {
        bottom: 0;
        right: 0;
        left: 0;
      }

      .OrientationPlugin .OrientationArrow:nth-child(4)::after {
        border-width: 5px 6px;
        border-color: transparent transparent var(--color) transparent;
        transform: translate(0, -15px);
      }
    `,this.wrapper.className="OrientationPlugin",this.arrows.className="OrientationArrows",this.wrapper.style.cssText="position: relative; width: 100%; height: 100%",this.wrapper.appendChild(this.arrows),this.arrowLeft.className=this.arrowRight.className=this.arrowTop.className=this.arrowBack.className=this.arrowFront.className="OrientationArrow",this.arrowBottom.className="OrientationArrow disabled",this.arrowBack.innerText="后",this.arrowFront.innerText="前",this.arrowLeft.innerText="左",this.arrowRight.innerText="右",this.arrowTop.innerText="上",this.arrowBottom.innerText="下",this.css3drenderer.domElement.style.cssText="position: absolute; top: 0; right: 0; bottom: 0; left: 0; pointer-events: none; color: #00000090;"},o.prototype.bindEvents=function(){var e=this;this.five.on("renderFrame",this.onRenderFrame),this.five.on("camera.update",this.onCameraUpdate),this.five.on("wantsGesture",this.onFiveWantsGesture),this.five.on("modeChange",this.onFiveModeChange),this.mc.on("tap",this.onTapGesture),this.mc.on("panstart",this.onPanStart),this.mc.on("panend",this.onPanEnd),this.wrapper.addEventListener("mousemove",this.onMouseMove),this.arrowTop.onclick=function(){return e.orient({longitude:0,latitude:le})},this.arrowLeft.onclick=function(){return e.orient({longitude:-le,latitude:0})},this.arrowRight.onclick=function(){return e.orient({longitude:le,latitude:0})},this.arrowFront.onclick=function(){return e.orient({longitude:0,latitude:0})},this.arrowBack.onclick=function(){return e.orient({longitude:Math.PI,latitude:0})}},o.prototype.unbindEvents=function(){this.five.off("renderFrame",this.onRenderFrame),this.five.off("camera.update",this.onCameraUpdate),this.five.off("wantsGesture",this.onFiveWantsGesture),this.five.off("modeChange",this.onFiveModeChange),this.mc.off("tap",this.onTapGesture),this.mc.off("panstart",this.onPanStart),this.mc.off("panend",this.onPanEnd),this.wrapper.removeEventListener("mousemove",this.onMouseMove),this.arrowTop.onclick=null,this.arrowLeft.onclick=null,this.arrowRight.onclick=null,this.arrowFront.onclick=null,this.arrowBack.onclick=null},o.prototype.updateByCamera=function(){var e=ot(.2,1,this.camera.pose.latitude/Math.PI*2,function(c){return c*c}),i=ot(11,13,this.camera.pose.latitude/Math.PI*2,function(c){return c*c}),t=ot(12,15,this.camera.pose.latitude/Math.PI*2,function(c){return c*c}),l=ot(13,19,this.camera.pose.latitude/Math.PI*2,function(c){return c*c}),u=ot(-.2,.5,this.camera.pose.latitude/Math.PI*2,function(c){return c*c});this.cylinder.geometry=new en(i,t,.01,50,1,!0),this.cylinder.material.uniforms.radiusTop.value=i,this.cylinder.material.uniforms.radiusBottom.value=t,this.cylinder.material.needsUpdate=!0,this.cylinder.children.forEach(function(c){c.position.normalize().multiplyScalar(l),c.scale.set(e,e,e);var m=c.children[0];m&&(m.element.style.opacity=u.toString())})},o.prototype.updateArrows=function(e){e.longitude;var i=e.latitude,t=le-i<.02;this.setState({arrowsVisible:t})},o.prototype.handleArrowsVisible=function(e){var i=this;if(this.state.enabled)if(this.cylinder.material.uniforms.opacity.value=e?.4:1,this.cylinder.material.needsUpdate=!0,e){var t=this.five.getCurrentState(),l=t.longitude,u=t.latitude;if(le-u<.03)this.five.state.mode==="Topview"||this.five.state.mode==="Mapview"?(this.faces.getObjectByName("上").element.className="active",this.arrows.innerHTML="",this.arrows.appendChild(this.arrowBack),this.arrows.appendChild(this.arrowLeft),this.arrows.appendChild(this.arrowRight),this.arrows.appendChild(this.arrowFront),this.arrows.style.transform="rotate(".concat((l-this.config.fixedLongitude)/Math.PI*180,"deg)")):(this.arrows.innerHTML="",this.faces.getObjectByName("上").element.className="");else{switch(this.arrows.innerHTML="",this.arrows.appendChild(this.arrowTop),this.config.orthoView&&this.five.ready().then(function(){i.five.controller.cameraType="orthographic",i.five.ready().then(function(){return i.five.controller.cameraMotion.ended=!1})}),!0){case it(0,l-this.config.fixedLongitude):this.arrows.appendChild(this.arrowLeft),this.arrows.appendChild(this.arrowRight),this.arrows.appendChild(this.arrowBottom),this.faces.getObjectByName("前").element.className="active";break;case it(le,l-this.config.fixedLongitude):this.arrows.appendChild(this.arrowFront),this.arrows.appendChild(this.arrowBack),this.arrows.appendChild(this.arrowBottom),this.faces.getObjectByName("右").element.className="active";break;case it(Math.PI,l-this.config.fixedLongitude):this.arrows.appendChild(this.arrowRight),this.arrows.appendChild(this.arrowLeft),this.arrows.appendChild(this.arrowBottom),this.faces.getObjectByName("后").element.className="active";break;default:this.arrows.appendChild(this.arrowBack),this.arrows.appendChild(this.arrowFront),this.arrows.appendChild(this.arrowBottom),this.faces.getObjectByName("左").element.className="active";break}this.arrows.style.transform=""}this.arrows.style.display="block"}else this.config.orthoView&&(this.five.controller.cameraType="auto",this.five.ready().then(function(){return i.five.controller.cameraMotion.ended=!1})),this.arrows.style.display="none",this.faces.children.forEach(function(c){c.children[0].element.className=""})},o.prototype.setState=function(e,i){i===void 0&&(i={});var t=this.state,l=i.userAction!==void 0?i.userAction:!0;if(this.updateState(e,l),e.enabled!==void 0&&t.enabled!==e.enabled){var u={userAction:l};e.enabled?this._enable(u):this._disable(u)}},o.prototype.initLights=function(){this.directionalLight.target=this.box,this.scene.add(this.ambientLight,this.directionalLight)},o.prototype.initFaces=function(){var e=sr(7,7,.5),i=new hi(e);i.translate(-3.5,-3.5,0);var t=new be(i,new Ye({transparent:!0,color:3370495,opacity:0}));t.userData={longitude:0,latitude:0},t.position.z=4.1,t.add(rt("前"));var l=new be(i,new Ye({transparent:!0,color:3370495,opacity:0}));l.rotateY(Math.PI),l.position.z=-4.1,l.add(rt("后")),l.userData={longitude:Math.PI,latitude:0};var u=new be(i,new Ye({transparent:!0,color:3370495,opacity:0}));u.rotateY(le),u.position.x=4.1,u.add(rt("右")),u.userData={longitude:le,latitude:0};var c=new be(i,new Ye({transparent:!0,color:3370495,opacity:0}));c.rotateY(-le),c.position.x=-4.1,c.add(rt("左")),c.userData={longitude:-le,latitude:0};var m=new be(i,new Ye({transparent:!0,color:3370495,opacity:0}));m.rotateX(-le),m.position.y=4.1,m.add(rt("上")),m.userData={longitude:0,latitude:le},this.faces.add(t,l,c,u,m)},o.prototype.initControls=function(){var e=this.controls=new ct(this.camera,this.renderer.domElement);e.enableZoom=!1,e.enableDamping=!0,e.enablePan=!1,e.maxPolarAngle=le,e.dampingFactor=.15,e.rotateSpeed=.25},o.prototype.load=function(e){return Xe(this,void 0,void 0,function(){return qe(this,function(i){return[2]})})},o.prototype._enable=function(e){var i=this.five.getCurrentState(),t=i.longitude,l=i.latitude;this.camera.setFromPose({longitude:t,latitude:l,distance:20,offset:new z(0,0,0)}),this.updateByCamera(),this.wrapper.appendChild(this.renderer.domElement),this.wrapper.appendChild(this.css3drenderer.domElement),this.bindEvents()},o.prototype._disable=function(e){this.wrapper.removeChild(this.renderer.domElement),this.wrapper.removeChild(this.css3drenderer.domElement),this.unbindEvents()},o.prototype.enable=function(e){var i;if(!this.state.enabled){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!0},t),this._enable({userAction:t}),document.head.appendChild(this.style)}},o.prototype.disable=function(e){var i;if(this.state.enabled!==!1){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!1},t),this._disable({userAction:t}),document.head.removeChild(this.style)}},o}(ze.Controller),cr=function(a,o){return new lr(a,o)};(function(a){Ke(o,a);function o(e,i){var t=a.call(this,e)||this;return t.data={},t.pluginName="BackgroundPlugin",t._onFiveCameraUpdate=function(l){var u=(Math.PI/2-Math.max(l.latitude,0))/(Math.PI/2),c=Math.max(.2-u,0)*10;t.gradientBg&&(t.gradientBg.style.transform="translateY(-".concat((1-u)*50,"%)")),t.groundBg&&(t.groundBg.style.backgroundImage="radial-gradient(circle, #2E303350 ".concat(c*100,"%, transparent ").concat(c*120,"%)"))},t._addEventListener=function(){t.five.on("cameraUpdate",t._onFiveCameraUpdate)},t._removeEventListener=function(){t.five.off("cameraUpdate",t._onFiveCameraUpdate)},t.load=function(){return Xe(t,void 0,void 0,function(){return qe(this,function(l){return[2]})})},t.setState=function(l,u){},t.enable=function(){var l,u=(l=t.five.getElement())===null||l===void 0?void 0:l.parentNode;if(!u){t.five.ready().then(function(){return t.enable()});return}t.state.enabled||(t._onFiveCameraUpdate(t.five.getPose(),!1),t.gradientBg&&u.appendChild(t.gradientBg),t.groundBg&&u.appendChild(t.groundBg),t.style&&document.head.appendChild(t.style),t._addEventListener(),t.hooks.emit("enable",{userAction:!0}),t.state.enabled=!0)},t.disable=function(l){var u,c,m,d;t.state.enabled&&((c=(u=t.gradientBg)===null||u===void 0?void 0:u.parentNode)===null||c===void 0||c.removeChild(t.gradientBg),(d=(m=t.groundBg)===null||m===void 0?void 0:m.parentNode)===null||d===void 0||d.removeChild(t.groundBg),t.style&&document.head.removeChild(t.style),t._removeEventListener(),t.hooks.emit("disable",{userAction:!0}),t.state.enabled=!1)},t.dispose=function(){t._removeEventListener(),t.hooks.emit("disable",{userAction:!0}),t.state.enabled=!1},t.state={enabled:!1},typeof document>"u"||(t.gradientBg=document.createElement("div"),t.groundBg=document.createElement("div"),t.style=document.createElement("style"),t.gradientBg.className="BackgroundPluginBg",t.groundBg.className="BackgroundPluginGroundBg",t.style.innerHTML=`
      .BackgroundPluginBg {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        height: 200%;
        background: linear-gradient(#0A0B0D, #2E3033);
        z-index: -1;
        pointerEvents: none;
      }
      .BackgroundPluginGroundBg {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        background-image: radial-gradient(circle, #2E303350 0, transparent 0);
        z-index: -1;
        pointerEvents: none;
      }
    `,t.enable()),t}return o})(ze.Controller);new Un().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]);var Kt=function(){function a(o,e,i,t,l){this.R=o,this.Q=e,this.A=i,this.B=t,this.C=l,this.cov=NaN,this.x=NaN}return a.prototype.filter=function(o,e){if(e===void 0&&(e=0),isNaN(this.x))this.x=1/this.C*o,this.cov=1/this.C*this.Q*(1/this.C);else{var i=this.A*this.x+this.B*e,t=this.A*this.cov*this.A+this.R,l=t*this.C*(1/(this.C*t*this.C+this.Q));this.x=i+l*(o-this.C*i),this.cov=t-l*this.C*t}return this.x},a}();(function(a){Ke(o,a);function o(e,i){var t=a.call(this,e)||this;t.dispose=function(){t.disable()},t.five=e;var l={enabled:!0,visible:!0};t.state=Object.assign(l,i==null?void 0:i.initialState);var u=K({},i==null?void 0:i.config);return t._config=u,t.state.enabled&&t._enable({userAction:!1}),t.cancelAnimation=null,t.skipStart=0,t.skipEnd=0,t.location=0,t.totalDistance=0,t.trajectory=null,t.currentKeyFrame=null,t.nextKeyframe=null,t.nextButOneKeyframe=null,t.keyframes=[],t.rate=t.config.rate||1,t.virualCamera=t.five.camera.clone(),t.playingState={keyframeIndex:null,progress:null},Object.defineProperties(t,{currentDistance:{get:function(){return this._currentDistance},set:function(c){this._currentDistance=c}}}),t}return Object.defineProperty(o.prototype,"config",{get:function(){return K({},this._config)},enumerable:!1,configurable:!0}),o.prototype.updateState=function(e,i){var t=this.state;this.state=K(K({},this.state),e),this.hooks.emit("stateChange",{state:this.state,prevState:t,userAction:i})},o.prototype.load=function(e){return Xe(this,void 0,void 0,function(){return qe(this,function(i){return[2]})})},o.prototype.loadTrajectory=function(e){this.trajectory=e,this.cancelAnimation&&this.cancelAnimation(),this.playingState.keyframeIndex=null,this.playingState.progress=null;var i=.01,t=.1,l=1,u=0,c=1,m=new Kt(i,t,l,u,c),d=new Kt(i,t,l,u,c),f=new Kt(i,t,l,u,c);if(this.trajectory&&this.trajectory.content.loadState==="READY"){for(var y=this.trajectory.content.data.positionArray,x=new Float32Array(y.length/3),E=0;E<x.length;E++)if(E===0)x[E]=0;else{var M=new z(y[E-3],y[E-2],y[E-1]),S=new z(y[E],y[E+1],y[E+2]);x[E]=S.distanceTo(M)+x[E-1]}this.totalDistance=x[x.length-1];for(var E=0;E<x.length;E++){for(var O=new z(0,0,0),T=0,g=E-5;g<E+6;g++)g>=0&&g<x.length&&(O.add(new z(y[g*3],y[g*3+1],y[g*3+2])),T++);O.divideScalar(T).applyMatrix4(e.transform);var C=m.filter(O.x),p=d.filter(O.y),w=f.filter(O.z),k={position:new z(C,p,w),location:x[E]};this.keyframes.push(k)}}else throw new Error("trajectory content is not ready")},o.prototype.setPlayingState=function(e){(e.keyframeIndex!==null||e.progress!==null)&&(this.cancelAnimation&&this.cancelAnimation(),this.playingState.keyframeIndex=e.keyframeIndex?e.keyframeIndex:this.playingState.keyframeIndex,this.playingState.progress=e.progress?e.progress:this.playingState.progress,this.play())},o.prototype._enable=function(e){},o.prototype.play=function(){var e=this,i=this.keyframes.length;if(i<2)throw new Error("keyframes length must be greater than 2");var t={keyframeIndex:null,progress:null};this.playingState.keyframeIndex!==null&&this.playingState.progress!==null?(t.keyframeIndex=this.playingState.keyframeIndex,t.progress=this.playingState.progress):this.playingState.keyframeIndex===null&&this.playingState.progress===null&&(this.playingState.keyframeIndex=this.skipStart,this.playingState.progress=0,this.virualCamera.position.copy(this.keyframes[this.playingState.keyframeIndex].position.clone()),this.virualCamera.lookAt(this.keyframes[1].position.clone()),this.virualCamera.computePose(),this.five.setState(K({},this.virualCamera.pose)));var l=this.playingState.keyframeIndex,u=0;this.cancelAnimation=an.shared.add(function(c,m){if(l===i-1-e.skipEnd&&e.cancelAnimation){e.cancelAnimation();return}e.currentKeyFrame=e.keyframes[l],e.nextKeyframe=e.keyframes[l+1],l+2<=i-1?e.nextButOneKeyframe=e.keyframes[l+2]:e.nextButOneKeyframe=null;var d=e.currentKeyFrame.position.clone(),f=e.nextKeyframe.position.clone(),y=e.nextKeyframe.position.clone().sub(e.currentKeyFrame.position.clone()).normalize(),x=d.clone().add(y.clone().multiplyScalar(.01)),E=new z;e.nextButOneKeyframe!==null?E=e.nextButOneKeyframe.position.clone().sub(e.nextKeyframe.position.clone()).normalize():E.copy(y);var M=f.clone().add(E.clone().multiplyScalar(.01));u+=m/1e3*e.rate;var S=u/d.distanceTo(f);S=S>=1?1:S,t.keyframeIndex!==null&&t.progress!==null&&(S=t.progress,t.keyframeIndex=null,t.progress=null);var O=d.clone().lerp(f,S),T=x.clone().lerp(M,S);e.virualCamera.position.copy(O),e.virualCamera.lookAt(T),e.virualCamera.updateMatrixWorld(),e.virualCamera.updateMatrix(),e.virualCamera.computePose(),e.five.setState(K({},e.virualCamera.pose)),e.location=e.keyframes[l].location+d.clone().distanceTo(O),S===1?(u=0,l++,e.playingState.keyframeIndex=l,e.playingState.progress=0):(e.playingState.keyframeIndex=l,e.playingState.progress=S)})},o.prototype.pause=function(){this.cancelAnimation&&this.cancelAnimation()},o.prototype.findKeyFrameByLocation=function(e){if(this.keyframes.length!==0){for(var i=0,t=this.keyframes.length-1;i<=t;){var l=Math.floor((i+t)/2);if(this.keyframes[l].location===e)return l;this.keyframes[l].location<e?i=l+1:t=l-1}return{keyframeIndex:i-1,progress:0}}},o.prototype.resetPlayingState=function(){this.playingState.keyframeIndex=null,this.playingState.progress=null},o.prototype._disable=function(e){},o.prototype.enable=function(e){var i;if(!this.state.enabled){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!0},t),this._enable({userAction:t})}},o.prototype.disable=function(e){var i;if(this.state.enabled!==!1){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!1},t),this._disable({userAction:t})}},o})(ze.Controller);function Dn(a,o,e){return a<o?o:a>e?e:a}var ur=`
varying vec2 vUv;
varying vec3 vPosition;
void main() {
  vUv = uv;
  vPosition = position;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,pr=`
varying vec2 vUv;
uniform sampler2D map;
uniform float progress;
uniform float opacity;
varying vec3 vPosition;

void main() {
  vec3 white = vec3(1.0, 1.0, 1.0);
  vec4 image = texture2D(map, vUv);
  if (vUv.y > progress) {
    discard;
  }
  gl_FragColor = vec4(white, 0.7 * (progress - vPosition.y));
  if (progress == 1.0) {
    gl_FragColor = gl_FragColor + vec4(image.rgb, image.a * (1.0 - vPosition.y));
  }
  gl_FragColor.a = gl_FragColor.a * opacity;
}
`,dr=[1,5,2,6,3,7,4,8,9,13,10,14,11,15,12,16],Zt=512,Qt=512,kt=128;(function(a){Ke(o,a);function o(e,i){var t=a.call(this,e)||this;t.group=new Nt,t.mesh=function(){var c=new en(.12,.12,1,32,1,!0);c.translate(0,.5,0);var m=new jt({vertexShader:ur,fragmentShader:pr,uniforms:{map:{value:new Hn},progress:{value:0},opacity:{value:0}},transparent:!0,depthTest:!1}),d=new be(c,m);return d}(),t.panoMesh=new Pi({scale:1.5}),t.stop=function(){},t.drawLine=function(c,m){if(t.ctx){var d=function(){var x,E=Zt/16|0;return E*((x=dr[c])!==null&&x!==void 0?x:0)}(),f=(1-(m+c*150)%1200/1200)*(Qt+kt),y=t.ctx.createLinearGradient(0,f-kt,0,f);y.addColorStop(0,"rgba(255,255,255,0)"),y.addColorStop(.5,"rgba(255,255,255,1)"),y.addColorStop(1,"rgba(255,255,255,0)"),t.ctx.fillStyle=y,t.ctx.fillRect(d,f-kt,3,kt)}},t.anime=function(c){if(t.ctx&&t.startTime){t.ctx.clearRect(0,0,Zt,Qt);for(var m=0;m<16;m++)t.drawLine(m,c-t.startTime);var d=Dn((c-t.startTime)/1e3,0,1),f=Dn((c-t.startTime)/300,0,1);t.panoMesh.setOpacity(f),t.mesh.material.uniforms.progress.value=d,t.mesh.material.uniforms.opacity.value=f,t.mesh.material.uniforms.map.value.needsUpdate=!0,t.five.needsRender=!0}},t.dispose=function(){t.disable()},t.five=e;var l={enabled:!1,visible:!0};t.state=Object.assign(l,i==null?void 0:i.initialState);var u=K({},i==null?void 0:i.config);return t._config=u,typeof document>"u"||(t.canvas=document.createElement("canvas"),t.ctx=t.canvas.getContext("2d"),t.canvas.width=Zt,t.canvas.height=Qt,t.ctx.shadowColor="rgba(255,255,255,0.5)",t.ctx.shadowBlur=6,t.ctx.shadowOffsetX=0,t.ctx.shadowOffsetY=0,t.mesh.material.uniforms.map.value=new Mi(t.canvas),t.group.add(t.mesh),t.panoMesh.setProgress(1),t.panoMesh.setOpacity(0),t.group.add(t.panoMesh),t.state.enabled&&t._enable({userAction:!1})),t}return Object.defineProperty(o.prototype,"config",{get:function(){return K({},this._config)},enumerable:!1,configurable:!0}),o.prototype.updateState=function(e,i){var t=this.state;this.state=K(K({},this.state),e),this.hooks.emit("stateChange",{state:this.state,prevState:t,userAction:i})},o.prototype.load=function(e){return Xe(this,void 0,void 0,function(){return qe(this,function(i){return[2]})})},o.prototype._enable=function(e){var i=this;this.mesh.position.copy(this.five.observers[this.five.state.panoIndex].standingPosition),this.panoMesh.position.copy(this.five.observers[this.five.state.panoIndex].standingPosition),this.five.ready().then(function(){i.five.scene.add(i.group),i.stop=an.shared.add(function(t,l){i.startTime||(i.startTime=t),i.panoMesh.updateTime(t,l),i.anime(t)})})},o.prototype._disable=function(e){this.five.scene.remove(this.group),this.panoMesh.setOpacity(0),this.startTime=void 0,this.stop(),this.five.needsRender=!0},o.prototype.enable=function(e){var i;if(this.ctx&&!this.state.enabled&&this.five.observers[this.five.state.panoIndex]){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!0},t),this._enable({userAction:t})}},o.prototype.disable=function(e){var i;if(this.state.enabled!==!1){var t=(i=e==null?void 0:e.userAction)!==null&&i!==void 0?i:!0;this.updateState({enabled:!1},t),this._disable({userAction:t})}},o.prototype.setState=function(e,i){i===void 0&&(i={});var t=this.state,l=i.userAction!==void 0?i.userAction:!0;if(this.updateState(e,l),e.enabled!==void 0&&t.enabled!==e.enabled){var u={userAction:l};e.enabled?this._enable(u):this._disable(u)}},o})(ze.Controller);const Oe=1.5,He=.8,hr=Oi({imageOptions:{size:1024},textureOptions:{size:1024},onlyRenderIfNeeds:!0,plugins:[[cr,"OrientationPlugin"],[Ii,"Sculpt",{theme:{point:{color:16777215},line:{lineColor:16777215,lineWidth:Oe},polyline:{lineColor:0,lineWidth:Oe},polygon:{color:16777215,lineColor:0,lineWidth:Oe,lineOpacity:He},prism:{color:16777215,lineColor:0,lineWidth:Oe,lineOpacity:He},rectangle:{color:16777215,lineColor:0,lineWidth:Oe,lineOpacity:He},circle:{color:16777215,lineColor:0,lineWidth:Oe,lineOpacity:He},cylinder:{color:16777215,lineColor:0,lineWidth:Oe,lineOpacity:He},box:{color:16777215,lineColor:0,lineWidth:Oe,lineOpacity:He}},config:{magnifier:{width:200,height:200,scale:2.5,dragEnabled:!0,autoFixPCPosition:!0,initialPosition:{left:"10%",top:"10%"},borderRadius:10,borderWidth:2,borderColor:"#ffffff"},hideCursorCircle:!1}}]]}),Bn=new URLSearchParams(window.location.search).get("workCode")??"",fr=new URLSearchParams(window.location.search).get("workType")??"real",mr=()=>{const a=rn();return X.useEffect(()=>{a.models.setMaterial({pointShape:"CIRCLE",pointSize:"ATTENUATION",pointBack:"VISIBLE",pointScale:.012,pointMinPixel:0,pointMaxPixel:40})},[a]),null},vr=()=>{const a=Lo(),o=localStorage.getItem(`dnawork-${location.pathname}`)??Gi($i.WORK,Bn,Bn?fr:void 0);return o?P.jsx(Ki,{theme:Zi,children:P.jsxs(hr,{initialOptions:{"3d-tiles":{minLevelOfDetail:1,maxScreenSpaceError:1}},initialWork:ji(o),initialState:{mode:"Mapview",latitude:.78,longitude:2},children:[P.jsx("div",{style:{position:"absolute",width:"100%",height:"100%"},children:P.jsx(Fi,{...a})}),P.jsx(Xo,{}),P.jsx(mr,{})]})}):null};Li.render(P.jsx(vr,{}),document.querySelector("#app"));
