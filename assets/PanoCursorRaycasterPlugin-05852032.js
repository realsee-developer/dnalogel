import{aD as E,V as l,m as A,u as C,r as x,q as M,J as B,n as L,X as F,j as t,F as P,G as H,p as D,I as N,a as k}from"./index-85b64ddc.js";import"./index-62a9cd62.js";import{d as W,a as G}from"./ViewInAr-fd4fa02b.js";import{B as O}from"./Box-d96aca33.js";import{P as j}from"./Paper-ead7a250.js";import{B as U}from"./ButtonGroup-da6043f4.js";import{B as _}from"./Button-c89038b2.js";import{B as I,a as z}from"./BottomNavigationAction-2b30d94e.js";import{u as J,D as q}from"./useFetchDatas-45e33e50.js";import"./Point-d3172315.js";import"./createTheme-a7bd8e9d.js";import"./createSvgIcon-c7bdef24.js";import"./createSvgIcon-0da8929c.js";import"./ButtonBase-4df208c3.js";import"./useControlled-e139503c.js";import"./useId-457cb0cd.js";import"./useTheme-28230d65.js";class V extends E{constructor(...s){super(...s)}toJSON(){return{type:"FiveLine",points:this.points.toJSON()}}}function y(e,s,a=new l(1,1,1),d=!1){const p=new V(e,s);return p.setMaterial({dashed:d,color:a,linewidth:1}),p.remove(p.points),p}const X=e=>{const s={intersection:null,disposers:[]},a=r=>{s.intersection=r},d=()=>{s.intersection=null};e.on("modelLoaded",()=>{e.on("intersectionOnModelUpdate",a),e.on("intersectionHidden",d)}),e.on("dispose",()=>{e.off("intersectionOnModelUpdate",a),e.off("intersectionHidden",d)});const p=(r,o=2,i=.1)=>{const c=o/2,n=h(r,i),m=new A;m.add(y(new l(n.x+c,n.y,n.z),new l(n.x-c,n.y,n.z),new l(1,0,0)),y(new l(n.x,n.y+c,n.z),new l(n.x,n.y-c,n.z),new l(0,1,0)),y(new l(n.x,n.y,n.z+c),new l(n.x,n.y,n.z-c),new l(0,0,1))),e.scene.add(m),e.needsRender=!0;const g=()=>{e.scene.remove(m)};return s.disposers.push(g),{clear:g,pointAxesHelperMesh:m}},f=(r,o=0)=>{var i,c;const n=(i=e==null?void 0:e.camera)==null?void 0:i.position;if(!n)return!1;const m=r.distanceTo(n),g=r.sub(n).normalize(),T=new C(n,g),S=(c=e.model.intersectRaycaster(T))==null?void 0:c[0];return!(S&&S.distance+o<m)},u=()=>s.intersection,w=()=>{var r,o;(o=(r=s.disposers)==null?void 0:r.forEach)==null||o.call(r,i=>i==null?void 0:i()),e.off("intersectionOnModelUpdate",a),e.off("intersectionHidden",d)},v=w,h=(r,o)=>{const i=r.clone();return e.camera.position.clone().sub(i).setLength(o).add(i)};return{intersection:u,pointAxesHelper:p,movePointTowardsCamera:h,destroy:w,dispose:v,canSeePoint:f}};function R(){return{width:window.innerWidth,height:window.innerHeight}}function K(){const[e,s]=x.useState(R);return x.useEffect(()=>{const a=()=>s(R());return window.addEventListener("resize",a,!1),()=>window.removeEventListener("resize",a,!1)}),e}const b={STOP:"停止选点",START:"进入选点",CLEAR:"清理"},Q=e=>{const a=M().plugins.panoCursorRaycasterPlugin,[d,p]=B(),f=L(),[u,w]=x.useState(!1),[v,h]=x.useState(),r=()=>{w(!u)};return F("wantsTapGesture",()=>{if(f!=="Loaded"){console.warn("five model not ready!");return}if(!u){console.warn("not allow to select point");return}const o=a.intersection();if(!o)return;console.info("vector3:",o.point),console.info("array: ",[o.point.x,o.point.y,o.point.z]),a.pointAxesHelper(o.point);const i=v||[];return i.push(o.point),h(i),!1},[u,f]),t.jsxs(O,{children:[t.jsx(j,{sx:{position:"fixed",top:"10px",right:"10px",backgroundColor:"transparent"},children:t.jsx(U,{size:"large","aria-label":"large button group",orientation:"vertical",children:t.jsx(_,{onClick:r,disabled:f!=="Loaded"||d.mode!==P.Mode.Panorama,children:u?b.STOP:b.START})})}),t.jsx(j,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:t.jsxs(I,{showLabels:!0,value:d.mode,onChange:(o,i)=>{p({mode:i})},children:[t.jsx(z,{label:"全景漫游",icon:t.jsx(W,{}),value:P.Mode.Panorama}),t.jsx(z,{label:"空间总览",icon:t.jsx(G,{}),value:P.Mode.Floorplan})]})})]})},Y=H({imageOptions:{size:512},textureOptions:{size:512},onlyRenderIfNeeds:!0,plugins:[[X,"panoCursorRaycasterPlugin"]]}),$=()=>{const e=K(),s=J(q.WORK),a=x.memo(()=>t.jsx(O,{className:"plugin-full-screen-container",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),()=>!0);return s&&t.jsxs(Y,{initialWork:D(s),children:[t.jsx(N,{...e}),t.jsx(a,{}),t.jsx(Q,{})]})};k.render(t.jsx($,{}),document.querySelector("#app"));
